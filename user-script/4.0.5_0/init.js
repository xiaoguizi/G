// ==UserScript==
// @name           百度密语
// @namespace      scottxp@126.com
// @description    百度密语, 百度密语贴吧辅助插件
// @include        http://tieba.baidu.com/*
// @version		   4.0.4

// ==/UserScript==
var cache;
var flag = false;
var script = "var%20MiyuVersion%20=%20%224.0.5%22;%0A%0Avar%20UA%20=%20%7B%0A%09ie%20:%20false,%0A%09ff%20:%20false,%0A%09chrome%20:%20false,%0A%09op%20:%20false,%0A%09init%20:%20function()%7B%0A%09%09var%20ua%20=%20navigator.userAgent.toLowerCase();%0A%09%09if(ua.indexOf('firefox')%20!=%20-1)%0A%09%09%09UA.ff%20=%20true;%0A%09%09else%20if(ua.indexOf('applewebkit')%20!=%20-1)%0A%09%09%09UA.chrome%20=%20true;%0A%09%09else%20if(ua.indexOf('opera')%20!=%20-1)%0A%09%09%09UA.op%20=%20true;%0A%09%09else%0A%09%09%09;%0A%09%7D%0A%7D%0AUA.init();%0Avar%20PT%20=%20%7B%0A%09%0A%09TB_LIST%20:%20%22tblist%22,%0A%09TB_TIEZI%20:%20%22tiezi%22,%0A%09TB_CLASSIC%20:%22tbclassic%22,%0A%09CLUB_LIST%20:%20%22clublist%22,%0A%09CLUB_TIEZI%20:%20%22clubtiezi%22,%0A%09OTHERS%20:%20%22others%22,%0A%09%0A%09_type%20:%20null,%0A%09%0A%09getType%20:%20function()%7B%0A%09%09if(!PT._type)%0A%09%09%09PT._type%20=%20PT.analyzePT();%0A%09%09return%20PT._type;%0A%09%7D,%0A%09%0A%09ifAppMatchPage%20:%20function(app)%7B%0A%09%09var%20array%20=%20app.pageTypes;%0A%09%09for%20(var%20i%20in%20array)%7B%0A%09%09%09if(PT.getType()%20==%20array%5Bi%5D)%0A%09%09%09%09return%20true;%0A%09%09%7D%0A%09%09return%20false;%0A%09%7D,%0A%09%0A%09analyzePT%20:%20function()%7B%0A%09%09if(PT.isTB_LIST())%0A%09%09%09return%20PT.TB_LIST;%0A%09%09else%20if(PT.isTB_TIEZI())%0A%09%09%09return%20PT.TB_TIEZI;%0A%09%09else%20if(PT.isTB_LIST())%0A%09%09%09return%20PT.TB_TIEZI;%0A%09%09else%20if(PT.isTB_CLASSIC())%0A%09%09%09return%20PT.TB_CLASSIC;%0A%09%09else%20if(PT.isCLUB_LIST())%0A%09%09%09return%20PT.CLUB_LIST;%0A%09%09else%20if(PT.isCLUB_TIEZI())%0A%09%09%09return%20PT.CLUB_TIEZI;%0A%09%09else%0A%09%09%09return%20PT.OTHERS;%0A%09%7D,%0A%09%0A%09isTB_LIST%20:%20function()%7B%0A%09%09return%20location.href.indexOf(%22kw=%22)%20!=%20-1;%0A%09%7D,%0A%09%0A%09isTB_TIEZI%20:%20function()%7B%0A%09%09var%20a%20=%20location.href.indexOf(%22z=%22)%20!=%20-1;%0A%09%09var%20b%20=%20$id(%22thread_title_ext%22)%20!=%20null;%0A%09%09return%20a%20&&%20b;%0A%09%7D,%0A%09%0A%09isTB_CLASSIC%20:%20function()%7B%0A%09%09var%20a%20=%20location.href.indexOf(%22z=%22)%20!=%20-1;%0A%09%09var%20b%20=%20$id(%22thread_title_ext%22)%20==%20null;%0A%09%09return%20a%20&&%20b;%0A%09%7D,%0A%09%0A%09isCLUB_LIST%20:%20function()%7B%0A%09%09var%20a%20=%20location.href.indexOf(%22http://tieba.baidu.com/club/%22)%20==%200;%0A%09%09var%20b%20=%20location.href.indexOf(%22/p/%22)%20==%20-1;%0A%09%09var%20c%20=%20location.href.indexOf(%22manage%22)%20==%20-1;%0A%09%09return%20a%20&&%20b%20&&%20c;%0A%09%7D,%0A%09%0A%09isCLUB_TIEZI%20:%20function()%7B%0A%09%09var%20a%20=%20location.href.indexOf(%22http://tieba.baidu.com/club/%22)%20==%200;%0A%09%09var%20b%20=%20location.href.indexOf(%22/p/%22)%20!=%20-1;%0A%09%09return%20a%20&&%20b;%0A%09%7D%0A%7D%0A%EF%BB%BFString.prototype.trim%20=%20function%20()%20%7B%0A%09return%20this.replace(/%5E%5Cs%5Cs*/,%20'').replace(/%5Cs%5Cs*$/,%20'');%0A%7D%0Ag_pg.flashLimite=10;%0Ag_pg.imageLimite=10;%0Afunction%20$id(id,%20doc)%7B%0A%09if(!doc)%0A%09%09doc%20=%20document;%0A%09return%20doc.getElementById(id);%0A%7D%0Afunction%20$tag(tagName,%20node)%7B%0A%09if(!node)%0A%09%09node%20=%20document;%0A%09return%20node.getElementsByTagName(tagName);%0A%7D%0Afunction%20$cls(className,%20tagName,%20tag)%7B%0A%09if(!tag)%0A%09%09tag%20=%20document;%0A%09var%20tags%20=%20%5B%5D;%0A%09var%20list%20=%20$tag(tagName,%20tag);%0A%09for(var%20i=0;%20i%20%3C%20list.length;%20i++)%7B%0A%09%09var%20node%20=%20list%5Bi%5D;%0A%09%09if(node.getAttribute('class')%20==%20className)%7B%0A%09%09%09tags.push(node);%0A%09%09%7D%0A%09%7D%0A%09return%20tags;%0A%7D%0Afunction%20$cre(tagName,%20doc)%7B%0A%09if(!doc)%0A%09%09doc%20=%20document;%0A%09return%20doc.createElement(tagName);%0A%7D%0Afunction%20myAlert(str)%7B%0A%09alert(str);%0A%7D%0A$p%20=%20%7B%0A%09//%E8%AE%BE%E7%BD%AECheckBox%0A%09setBoxChecked%20:%09function(id,%20bool)%7B%0A%09%09if(bool)%0A%09%09%09$id(id).setAttribute(%22checked%22,%22checked%22);%0A%09%09else%0A%09%09%09$id(id).removeAttribute(%22checked%22);%0A%09%7D,%0A%09getSearchInput%20:%20function()%7B%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.CLUB_TIEZI:%0A%09%09%09case%20PT.CLUB_LIST:%0A%09%09%09%09return%20$id('search_word');%0A%09%09%09case%20PT.TB_TIEZI:%0A%09%09%09case%20PT.TB_LIST:%0A%09%09%09case%20PT.TB_CLASSIC:%0A%09%09%09%09return%20$id('wd1');%0A%09%09%7D%0A%09%7D,%0A%09getMaxFloorNum%20:%20function()%7B%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.CLUB_TIEZI:%0A%09%09%09%09var%20div%20=%20$tag('div',$id('pagerbar_header'))%5B0%5D;%0A%09%09%09%09var%20span%20=%20$tag('span',div)%5B0%5D;%0A%09%09%09%09return%20parseInt(span.innerHTML);%0A%09%09%09case%20PT.TB_TIEZI:%0A%09%09%09case%20PT.TB_CLASSIC:%0A%09%09%09%09var%20span%20=%20$cls('post_num','span',$id('thread_header'))%5B0%5D;%0A%09%09%09%09return%20parseInt(span.innerHTML);%0A%09%09%09default:%0A%09%09%09%09return%20null;%0A%09%09%7D%0A%09%7D,%0A%09getMaxPageNum%20:%20function()%7B%0A%09%09var%20floors%20=%20$p.getMaxFloorNum();%0A%09%09return%20Math.floor(floors/30)+1;%0A%09%7D%0A%7D%0A%EF%BB%BFvar%20Data%20=%20%7B%0A%09data%20:%20%7B%7D,%0A%09save%20:%20function(app)%7B%0A%09%09console.log(app);%0A%09%09var%20key%20=%20app.id;%0A%09%09var%20value%20=%20JSON.stringify(app.data);%0A%09%09localStorage.setItem(key,%20value);%0A%09%09console.log(%22Data.save%20%22+key+%22%20%22+value);%0A%09%7D,%0A%09load%20:%20function(app)%7B%0A%09%09var%20key%20=%20app.id;%0A%09%09var%20value%20=%20localStorage.getItem(key);%0A%09%09console.log(%22Data.load%20%22+key+%22%20%22+value);%0A%09%09var%20obj%20=%20JSON.parse(value);%0A%09%09if(obj)%7B%0A%09%09%09for(var%20i%20in%20obj)%0A%09%09%09%09app.data%5Bi%5D%20=%20obj%5Bi%5D;%0A%09%09%7D%0A%09%7D,%0A%09clear%20:%20function()%7B%0A%09%09localStorage.clear();%0A%09%7D,%0A%09%0A%09setCfg%20:%20function(str)%7B%0A%09%09var%20obj%20=%20%20JSON.parse(str);%0A%09%09for(var%20key%20in%20obj)%7B%0A%09%09%09localStorage%5Bkey%5D%20=%20obj%5Bkey%5D;%0A%09%09%7D%0A%09%7D,%0A%09%0A%09getCfg%20:%20function()%7B%0A%09%09var%20obj%20=%7B%7D;%0A%09%09for(var%20i=0;i%20%3C%20localStorage.length;i++)%7B%0A%09%09%09key%20=%20localStorage.key(i);%0A%09%09%09obj%5Bkey%5D%20=%20localStorage%5Bkey%5D;%0A%09%09%7D%0A%09%09return%20JSON.stringify(obj);%0A%09%7D,%0A%09%0A%7D%0A%EF%BB%BFMyPanel%20=%20%7B%0A%09TAB_PRE%20:%20%22tab_%22,%0A%09PANEL_PRE%20:%20%22panel_%22,%0A%09BUTTON_ID%20:%20%22myCButton%22,%0A%09PANEL_ID%20:%20%22myCPanel%22,%0A%09TabParent_ID%20:%20%22tabParent%22,%0A%09PanelParent_ID%20:%20%22panelParent%22,%0A%09ButtonBar_ID%20:%20%22buttonbar%22,%0A%09CButton_ID%20:%20%22cButton%22,%0A%09id%20:%20%22MyPanel%22,%0A%09%0A%09_ids%20:%20%5B%5D,%0A%09%0A%09data%20:%20%7B%0A%09%09showPanel%20:%20true,%0A%09%09showId%20:%20null%0A%09%7D,%0A%09%0A%09init%20:%20function()%7B%0A%09%09MyPanel.initPanel();%0A%09%09MyPanel.initCButton();%0A%09%7D,%0A%09initPanel%20:%20function()%7B%0A%09%09var%20div%20=%20$cre('div');%0A%09%09div.innerHTML%20=%20'%3Cdiv%20id=%22'+MyPanel.ButtonBar_ID+'%22style=%22text-align:right;%22%3E%3C/div%3E%3Cdiv%20%3E&nbsp;%3C/div%3E%20%3Cdiv%20id%20=%22'+MyPanel.PANEL_ID+'%22align=%22center%22%20style=%22width:100%25;display:none%22%20%3E%20%3Chr%3E%3Cdiv%20%3E&nbsp;%3C/div%3E%20%3Cdiv%20%3E%3Cul%20id=%22'+MyPanel.TabParent_ID+'%22%3E%3C/ul%3E%3C/div%3E%3Cdiv%20%3E&nbsp;%3C/div%3E%20%3Cdiv%20id=%22'+MyPanel.PanelParent_ID+'%22%3E%3C/div%3E%20%3Cdiv%3E&nbsp;%3C/div%3E%3Cdiv%20align=%22right%22%3E%3Cdiv%20align=%22right%22%3E%3Ca%20href=%22http://hi.baidu.com/matrox/blog/item/4a0b44e76fd7de22b938209e.html%22%20target=%22_blank%22%3E%E4%BD%BF%E7%94%A8%E5%B8%AE%E5%8A%A9%3C/a%3E&nbsp;&nbsp;&nbsp;%3Ca%20href=%22http://tieba.baidu.com/club/10298866/%22%20target=%22_blank%22%3E%E7%99%BE%E5%BA%A6%E5%AF%86%E8%AF%AD%E4%BF%B1%E4%B9%90%E9%83%A8%3C/a%3E&nbsp;&nbsp;%3Ca%20href=%22http://hi.baidu.com/matrox%22%20target=%22_blank%22%3E%E4%BD%9C%E8%80%85%E4%B8%BB%E9%A1%B5%3C/a%3E&nbsp;&nbsp;v'+MiyuVersion+'%3C/div%3E%3C/div%3E%20%3Chr%3E%20%3C/div%3E%20';%0A%09%09var%20nid%20;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_LIST:%0A%09%09%09%09nid%20=%20%22editor%22;%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_TIEZI:%0A%09%09%09%09div.style.width='75%25';%0A%09%09%09%09nid%20=%20%22editor%22;%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_CLASSIC:%0A%09%09%09%09div.style.width='75%25';%0A%09%09%09%09nid%20=%20%22c_editor_wrapper%22;%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_LIST:%0A%09%09%09case%20PT.CLUB_TIEZI:%0A%09%09%09%09nid%20=%20%22add_post_form%22;%0A%09%09%09%09break;%0A%09%09%09case%20PT.OTHERS:%0A%09%09%09%09myAlert(%22panel%20error%22);%0A%09%09%7D%0A%09%09$id(nid).parentNode.insertBefore(div,%20$id(nid));%0A%09%7D,%0A%09initCButton%20:%20function()%7B%0A%09%09MyPanel.addButton(MyPanel.CButton_ID,%22loading...%22,MyPanel.cButtonAction);%0A%09%7D,%0A%09addNewTab%20:%20function(id,%20name)%7B%0A%09%09console.log(%22Mypanel%20:%20addNewTab%20%22+id+%22%20%22+name);%0A%09%09var%20li%20=%20$cre('li');%0A%09%09li.setAttribute(%22style%22,%22display:inline;margin-left:16px;%22);%0A%09%09li.innerHTML%20=%20%22%3Ca%20id=%22%20+%20MyPanel.TAB_PRE%20+%20id%20+%20%22%20href='##'%20onclick='MyPanel.showTabAction(this);'%3E%22%20+%20name%20+%20%22%3C/a%3E%22;%0A%09%09var%20parent%20=%20$id(MyPanel.TabParent_ID);%0A%09%09parent.appendChild(li);%0A%09%7D,%0A%09addNewPanel%20:%20function(id,%20html)%7B%0A%09%09console.log(%22Mypanel%20:%20addNewPanel%20%22+id+%22%20%22+name);%0A%09%09var%20div%20=%20$cre('div');%0A%09%09div.id%20=%20MyPanel.PANEL_PRE%20+%20id;%0A%09%09div.innerHTML%20=%20html;%0A%09%09div.style.display='none';%0A%09%09$id(MyPanel.PanelParent_ID).appendChild(div);%0A%09%7D,%0A%09%0A%09addApp%20:%20function(app)%7B%0A%09%09MyPanel.addNewTab(app.id,%20app.name);%0A%09%09MyPanel.addNewPanel(app.id,%20app.getPanelHTML());%0A%09%09MyPanel._ids.push(app.id);%0A%09%7D,%0A%09addButton%20:%20function(id,%20text,%20func)%7B%0A%09%09var%20button%20=%20$cre('input');%0A%09%09button.id%20=%20id;%0A%09%09button.type%20=%20%22button%22;%0A%09%09button.value%20=%20text;%0A%09%09button.onclick%20=%20func;%0A%09%09var%20node%20=%20$id(MyPanel.ButtonBar_ID);%0A%09%09var%20buttons%20=%20$tag('input',%20node);%0A%09%09if(buttons.length%20%3E%200)%0A%09%09%09node.insertBefore(button,%20buttons%5B0%5D);%0A%09%09else%0A%09%09%09node.appendChild(button);%0A%09%7D,%0A%09setStatus%20:%20function()%7B%0A%09%09MyPanel.setCButton();%0A%09%09MyPanel.setPanel();%0A%09%09MyPanel.setTab();%0A%09%7D,%0A%09setTab%20:%20function()%7B%0A%09%09var%20id%20=%20MyPanel.data.showId;%0A%09%09if(!id%20%7C%7C%20!$id(MyPanel.PANEL_PRE+id))%0A%09%09%09id%20=%20MyPanel._ids%5B0%5D;%0A%09%09if(!id)%0A%09%09%09return;%0A%09%09MyPanel.showTab(id);%0A%09%7D,%0A%09setCButton%20:%20function()%7B%0A%09%09var%20button%20=%20$id(MyPanel.CButton_ID);%0A%09%09if(MyPanel.data.showPanel)%0A%09%09%09button.value%20=%20%22%E5%85%B3%E9%97%AD%E5%AF%86%E8%AF%AD%E9%9D%A2%E6%9D%BF%22;%0A%09%09else%0A%09%09%09button.value%20=%20%22%E6%89%93%E5%BC%80%E5%AF%86%E8%AF%AD%E9%9D%A2%E6%9D%BF%22;%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09var%20style%20=%20$id(MyPanel.PANEL_ID).style;%0A%09%09if(MyPanel.data.showPanel)%0A%09%09%09style.display='';%0A%09%09else%0A%09%09%09style.display='none';%0A%09%7D,%0A%09showTab%20:%20function(id)%7B%0A%09%09var%20ids%20=%20MyPanel._ids;%0A%09%09for(var%20i=0;i%20%3C%20ids.length;i++)%7B%0A%09%09%09$id(MyPanel.PANEL_PRE+ids%5Bi%5D).style.display%20=%20'none';%0A%09%09%7D%0A%09%09console.log(%22MyPanel:%20showTab:%22+MyPanel.PANEL_PRE%20+%20id);%0A%09%09$id(MyPanel.PANEL_PRE+id).style.display%20=%20'';%0A%09%7D,%0A%09%0A%09showTabAction%20:%20function(node)%7B%0A%09%09console.log(%22MyPanel:%20showTabAction%22);%0A%09%09var%20id%20=%20node.id.substring(MyPanel.TAB_PRE.length);%0A%09%09if(MyPanel.data.showId%20==%20id)%0A%09%09%09return%20;%0A%09%09else%7B%0A%09%09%09MyPanel.showTab(id);%0A%09%09%09MyPanel.data.showId%20=%20id;%0A%09%09%09MyPanel.save();%0A%09%09%7D%0A%09%7D,%0A%09cButtonAction%20:%20function()%7B%0A%09%09console.log(%22MyPanel:%20cButtonAction%22);%0A%09%09MyPanel.data.showPanel%20=%20!MyPanel.data.showPanel;%0A%09%09MyPanel.setCButton();%0A%09%09MyPanel.setPanel();%0A%09%09MyPanel.save();%0A%09%7D,%0A%09%0A%09save%20:%20function()%7B%0A%09%09Data.save(MyPanel);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(MyPanel);%0A%09%7D%0A%7D%0Avar%20Encryptor%20=%20%7B%0A%09DEFAULT_PW%20:%20%221234%22,%0A%09%0A%09s1%20:%20'0123456789abcdef',%0A%09s2%20:%20'%7B%7D%5B%5D()-_*@!~%60,.?',%0A%09%0A%09encrypt2%20:%20function(str,%20pw)%7B%0A%09%09str%20=%20Encryptor.encrypt(str,%20pw);%0A%09%09var%20newStr%20=%20%22%22;%0A%09%09var%20index;%0A%09%09for(var%20i=0;i%20%3C%20str.length;i++)%7B%0A%09%09%09index%20=%20parseInt(str%5Bi%5D,16);%0A%09%09%09newStr%20+=%20Encryptor.s2.charAt(index);%0A%09%09%7D%0A%09%09return%20newStr;%0A%09%7D,%0A%09decrypt2%20:%20function(str,%20pw)%7B%0A%09%09if(!str%20%7C%7C%20str%20==%20%22%22)%0A%09%09%09return%20%22%22;%0A%09%09var%20newStr='';%0A%09%09for(var%20i=0;i%20%3C%20str.length;i++)%7B%0A%09%09%09index%20=%20Encryptor.s2.indexOf(str%5Bi%5D);%0A%09%09%09newStr%20+=%20Encryptor.s1.charAt(index);%0A%09%09%7D%0A%09%09if(newStr.length%20%3C%208)%0A%09%09%09return%20%22%22;%0A%09%09newStr%20=%20Encryptor.decrypt(newStr,%20pw);%0A%09%09return%20newStr;%0A%09%7D%0A%7D;%0AEncryptor.encrypt=function(str,%20pw)%20%7B%0A%20%20%20%20if(str==%22%22)return%20%22%22;%0A%20%20%20%20str%20=%20escape(str);%0A%20%20%20%20if(!pw%20%7C%7C%20pw==%22%22)%7B%20var%20pw=%221234%22;%20%7D%0A%20%20%20%20pw%20=%20escape(pw);%0A%20%20%20%20%20%20if(pw%20==%20null%20%7C%7C%20pw.length%20%3C=%200)%20%7B%0A%20%20%20%20%20%20%20%20myAlert(%22pw%20er%22);%0A%20%20%20%20%20%20%20%20%20%20return%20null;%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20var%20prand%20=%20%22%22;%0A%20%20%20%20%20%20for(var%20I=0;%20I%20%3C%20pw.length;%20I++)%20%7B%0A%20%20%20%20%20%20%20%20prand%20+=%20pw.charCodeAt(I).toString();%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20var%20sPos%20=%20Math.floor(prand.length%20/%205);%0A%20%20%20%20%20%20var%20mult%20=%20parseInt(prand.charAt(sPos)%20+%20prand.charAt(sPos*2)%20+%20prand.charAt(sPos*3)%20+%20prand.charAt(sPos*4)%20+%20prand.charAt(sPos*5));%0A%0A%20%20%20%20%20%20var%20incr%20=%20Math.ceil(pw.length%20/%202);%0A%20%20%20%20%20%20var%20modu%20=%20Math.pow(2,%2031)%20-%201;%0A%20%20%20%20%20%20if(mult%20%3C%202)%20%7B%0A%20%20%20%20%20%20%20%20myAlert(%22pw%20er%22);%0A%20%20%20%20%20%20%20%20return%20null;%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20var%20salt%20=%20Math.round(Math.random()%20*%201000000000)%20%25%20100000000;%0A%20%20%20%20%20%20prand%20+=%20salt;%0A%20%20%20%20%20%20while(prand.length%20%3E%2010)%20%7B%0A%20%20%20%20%20%20%20%20prand%20=%20(parseInt(prand.substring(0,%2010))%20+%20parseInt(prand.substring(10,%20prand.length))).toString();%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20prand%20=%20(mult%20*%20prand%20+%20incr)%20%25%20modu;%0A%20%20%20%20var%20enc_chr%20=%20%22%22;%0A%20%20%20%20var%20enc_str%20=%20%22%22;%0A%20%20%20%20for(var%20I=0;%20I%20%3C%20str.length;%20I++)%20%7B%0A%20%20%20%20%20%20%20%20enc_chr%20=%20parseInt(str.charCodeAt(I)%20%5E%20Math.floor((prand%20/%20modu)%20*%20255));%0A%20%20%20%20%20%20%20%20if(enc_chr%20%3C%2016)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20enc_str%20+=%20%220%22%20+%20enc_chr.toString(16);%0A%20%20%20%20%20%20%20%20%7Delse%20%0A%20%20%20%20%20%20%20%20%20%20%20%20enc_str%20+=%20enc_chr.toString(16);%0A%20%20%20%20%20%20%20%20prand%20=%20(mult%20*%20prand%20+%20incr)%20%25%20modu;%0A%20%20%20%20%7D%0A%20%20%20%20%20%20salt%20=%20salt.toString(16);%0A%20%20%20%20%20%20while(salt.length%20%3C%208)salt%20=%20%220%22%20+%20salt;%0A%20%20%20%20enc_str%20+=%20salt;%0A%20%20%20%20return%20enc_str;%0A%7D%0AEncryptor.decrypt=function(str,%20pw)%20%7B%0A%20%20%20%20if(str==%22%22)return%20%22%22;%0A%20%20%20%20if(!pw%20%7C%7C%20pw==%22%22)%7B%20var%20pw=%221234%22;%20%7D%0A%20%20%20%20pw%20=%20escape(pw);%0A%20%20%20%20%20%20if(str%20==%20null%20%7C%7C%20str.length%20%3C%208)%20%7B%0A%20%20%20%20%20%20%20%20myAlert(%22str%20er.%22);%0A%20%20%20%20%20%20%20%20return;%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if(pw%20==%20null%20%7C%7C%20pw.length%20%3C=%200)%20%7B%0A%20%20%20%20%20%20%20%20myAlert(%22PW%20er%22);%0A%20%20%20%20%20%20%20%20return;%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20var%20prand%20=%20%22%22;%0A%20%20%20%20%20%20for(var%20I=0;%20I%3C%20pw.length;%20I++)%20%7B%0A%20%20%20%20%20%20%20%20prand%20+=%20pw.charCodeAt(I).toString();%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20var%20sPos%20=%20Math.floor(prand.length%20/%205);%0A%20%20%20%20%20%20var%20mult%20=%20parseInt(prand.charAt(sPos)%20+%20prand.charAt(sPos*2)%20+%20prand.charAt(sPos*3)%20+%20prand.charAt(sPos*4)%20+%20prand.charAt(sPos*5));%0A%20%20%20%20%20%20var%20incr%20=%20Math.round(pw.length%20/%202);%0A%20%20%20%20%20%20var%20modu%20=%20Math.pow(2,%2031)%20-%201;%0A%20%20%20%20%20%20var%20salt%20=%20parseInt(str.substring(str.length%20-%208,%20str.length),%2016);%0A%20%20%20%20%20%20str%20=%20str.substring(0,%20str.length%20-%208);%0A%20%20%20%20%20%20prand%20+=%20salt;%0A%20%20%20%20%20%20while(prand.length%20%3E%2010)%20%7B%0A%20%20%20%20%20%20%20%20prand%20=%20(parseInt(prand.substring(0,%2010))%20+%20parseInt(prand.substring(10,%20prand.length))).toString();%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20prand%20=%20(mult%20*%20prand%20+%20incr)%20%25%20modu;%0A%20%20%20%20%20%20var%20enc_chr%20=%20%22%22;%0A%20%20%20%20%20%20var%20enc_str%20=%20%22%22;%0A%20%20%20%20for(var%20I=0;%20I%3C%20str.length;%20I+=2)%20%7B%0A%20%20%20%20%20%20%20%20enc_chr%20=%20parseInt(parseInt(str.substring(I,%20I+2),%2016)%20%5E%20Math.floor((prand%20/%20modu)%20*%20255));%0A%20%20%20%20%20%20%20%20enc_str%20+=%20String.fromCharCode(enc_chr);%0A%20%20%20%20%20%20%20%20prand%20=%20(mult%20*%20prand%20+%20incr)%20%25%20modu;%0A%20%20%20%20%7D%0A%20%20%20%20return%20unescape(enc_str);%0A%7D%0A%EF%BB%BFvar%20MyApps%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_LIST,%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_LIST,%0A%09%09PT.CLUB_TIEZI,%0A%09%5D,%0A%09%0A%09_apps%20:%20%5B%5D,%0A%09%0A%09initApp%20:%20function()%7B%0A%09%09for(var%20i%20in%20MyApps._apps)%7B%0A%09%09%09var%20app%20=%20MyApps._apps%5Bi%5D;%0A%09%09%09if(PT.ifAppMatchPage(app))%7B%0A%09%09%09%09app.load();%0A%09%09%09%09MyPanel.addApp(app);%0A%09%09%09%09if(app.setPanel)%0A%09%09%09%09%09app.setPanel();%0A%09%09%09%09if(app.setFloorHandler)%0A%09%09%09%09%09app.setFloorHandler();%0A%09%09%09%09if(app.setFloorHTMLFilter)%0A%09%09%09%09%09app.setFloorHTMLFilter();%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D,%0A%09%0A%09runAll%20:%20function()%7B%0A%09%09for(var%20i%20in%20MyApps._apps)%7B%0A%09%09%09var%20app%20=%20MyApps._apps%5Bi%5D;%0A%09%09%09if(PT.ifAppMatchPage(app))%0A%09%09%09%09app.start();%0A%09%09%7D%0A%09%7D,%0A%09%0A%09add%20:%20function(item)%7B%0A%09%09MyApps._apps.push(item);%0A%09%7D,%0A%09%0A%09start%20:%20function()%7B%0A%09%09if(top%20!=%20self)%0A%09%09%09return%20;%0A%09%09console.log(%22MyApp%20Start!%22);%0A%09%09if(!PT.ifAppMatchPage(MyApps))%0A%09%09%09return%20;%0A%09%09MyPanel.init();%0A%09%09MyApps.initApp();%0A%09%09MyPanel.load();%0A%09%09MyPanel.setStatus();%0A%09%09MyApps.runAll();%0A%09%7D%0A%7D%0A%EF%BB%BF////////////////////////////////////////////////////////%09%0A//Bar%20Manager%0ABARM%20=%20%7B%0A%09//%E8%BF%BD%E5%8A%A0%E6%8C%87%E5%AE%9A%E6%A5%BC%E5%B1%82bar%E8%8A%82%E7%82%B9%0A%09addItemInFloor%20:%20function(node%20,floor)%7B%0A%09%09var%20item%20=%20BARM.wrapBarItem(node);%0A%09%09var%20bar%20=%20BARM.getBar(floor);%0A%09%09BARM.insertBarItem(item,%20bar,%20-1);%0A%09%7D,%0A%09//%E5%9C%A8%E9%A6%96%E9%A1%B9%E6%8F%92%E5%85%A5%E6%8C%87%E5%AE%9A%E6%A5%BC%E5%B1%82bar%E8%8A%82%E7%82%B9%0A%09insertFirstItemInFloor%20:%20function(node,%20floor)%7B%0A%09%09var%20item%20=%20BARM.wrapBarItem(node);%0A%09%09var%20bar%20=%20BARM.getBar(floor);%0A%09%09BARM.insertBarItem(item,%20bar,%200);%0A%09%7D,%0A%09//%E5%9C%A8%E6%89%80%E6%9C%89%E6%A5%BC%E5%B1%82%E6%B7%BB%E5%8A%A0bar%E8%8A%82%E7%82%B9%0A%09addItemInAllFloors%20:%20function(node)%7B%0A%09%09var%20floors%20=%20FLM.getFloors();%0A%09%09for(var%20i=0;%20i%3C%20floors.length;i++)%7B%0A%09%09%09BARM.addItemInFloor(node,%20floors%5Bi%5D);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09//%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E6%A5%BC%E5%B1%82%E7%9A%84bar%0A%09getBar%20:%20function(floor)%7B%0A%09%09var%20bar;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09var%20td%20=%20$cls(%22info%20gray%22,%20%22td%22%20,floor)%5B0%5D;%0A%09%09%09%09bar%20=%20$tag(%22ul%22,td)%5B0%5D;%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09bar%20=%20$cls(%22c_post_op%22,%20%22ul%22,%20floor)%5B0%5D;%0A%09%09%09%09break;%20%0A%09%09%09case%20PT.CLUB_TIEZI%20:%20%0A%09%09%09%09bar%20=%20$cls(%22info%20post_link%20post_op%22,%20%22td%22,%20floor)%5B0%5D;%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%09return%20bar;%0A%09%7D,%0A%09//%E5%B0%86bar%E8%8A%82%E7%82%B9%E6%8F%92%E5%85%A5%E6%8C%87%E5%AE%9Abar%0A%09insertBarItem%20:%20function(node,%20bar,%20index)%7B%0A%09%09var%20huifu%20=%20BARM.getHuiFuNode(bar);%0A%09%09if(index%20==%20-1)%0A%09%09%09bar.insertBefore(node,%20huifu);%0A%09%09else%0A%09%09%09bar.insertBefore(node,%20bar.childNodes%5Bindex+2%5D);%0A%09%7D,%0A%09//%E8%8E%B7%E5%BE%97%E2%80%9C%E5%9B%9E%E5%A4%8D%E2%80%9Dbar%E8%8A%82%E7%82%B9%0A%09getHuiFuNode%20:%20function(bar)%7B%0A%09%09var%20nodes%20=%20bar.childNodes;%0A%09%09for(var%20i=0;%20i%3C%20nodes.length;%20i++)%7B%0A%09%09%09if(nodes%5Bi%5D.textContent.indexOf(%22%E5%9B%9E%E5%A4%8D%22)%20!=%20-1)%7B%0A%09%09%09%09return%20nodes%5Bi%5D;%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D,%0A%09//%E5%B0%86%E8%8A%82%E7%82%B9%E6%89%93%E5%8C%85%E4%B8%BAbar%E8%8A%82%E7%82%B9%0A%09wrapBarItem%20:%20function(node)%7B%0A%09%09var%20item;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09item%20=%20$cre(%22li%22);%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_TIEZI%20:%20%0A%09%09%09%09item%20=%20$cre(%22span%22);%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%09item.appendChild(node);%0A%09%09return%20item;%0A%09%7D%0A%7D%0A%EF%BB%BF////////////////////////////////////////////////%09%0A//FloorHandler%20Manager%0AFHM%20=%20%7B%0A%09_handler%20:%20%5B%5D,%0A%09//%E6%B7%BB%E5%8A%A0%E6%A5%BC%E5%B1%82%E5%A4%84%E7%90%86%E5%99%A8%0A%09addFloorHandler%20:%20function(func)%7B%0A%09%09FHM._handler.push(func);%0A%09%7D,%0A%09%0A%09handleFloor%20:%20function(floor,%20split)%7B%0A%09%09for(var%20i=0;%20i%3C%20FHM._handler.length;%20i++)%0A%09%09%09FHM._handler%5Bi%5D(floor,%20split);%0A%09%7D,%0A%09%0A%09//%E5%B0%86%E6%AF%8F%E4%B8%AAfunc%E4%BD%9C%E7%94%A8%E4%BA%8Efloor%0A%09funcToFloors%20:%20function(func)%7B%0A%09%09var%20fs%20=%20FLM.getFloors();%0A%09%09for(var%20i=0;%20i%3C%20fs.length;%20i++)%0A%09%09%09func(fs%5Bi%5D);%0A%09%7D%0A%0A%7D%0A%EF%BB%BFURLM%20=%20%7B%0A%09getTieziId%20:%20function()%7B%0A%09%09var%20id;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI:%0A%09%09%09case%20PT.TB_CLASSIC:%0A%09%09%09%09var%20id%20=%20URLM.getPara(%22kz%22);%0A%09%09%09%09if(!id)%0A%09%09%09%09%09id%20=%20URLM.getPara(%22z%22);%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_TIEZI:%0A%09%09%09%09var%20i%20=%20location.pathname.indexOf('/p/')%0A%09%09%09%09id%20=%20location.pathname.substring(i%20+%20'/p/'.length);%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%09return%20id;%0A%09%7D,%0A%09getPara%20:%20function(key)%7B%0A%09%09var%20array%20=%20location.search.substring(1).split('&');%0A%09%09if(PT.getType()%20==%20PT.TB_TIEZI%20&&%20array.length%3C%202)%0A%09%09%09array%20=%20PageData.thread_cur_url.substring(3).split('&');%0A%09%09for(var%20i=0;%20i%3C%20array.length;%20i++)%7B%0A%09%09%09var%20str%20=%20array%5Bi%5D;%0A%09%09%09if(str.length%3C%202)%0A%09%09%09%09continue;%0A%09%09%09var%20pair%20=%20str.split(%22=%22);%0A%09%09%09if(pair%5B0%5D%20==%20key)%0A%09%09%09%09return%20pair%5B1%5D;%0A%09%09%7D%0A%09%09return%20null;%0A%09%7D,%0A%09getGoUrlByPageNum%20:%20function(num)%7B%0A%09%09if(isNaN(num))%0A%09%09%09%09%09return%20'#';%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI:%0A%09%09%09case%20PT.TB_CLASSIC:%0A%09%09%09%09var%20z=%20URLM.getTieziId();%0A%09%09%09%09return%20'http://tieba.baidu.com/f?z='+z+'&ct=335544320&rn=30&tn=baiduPostBrowser&pn='+(num-1)*30;%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_TIEZI:%0A%09%09%09%09return%20location.pathname%20+%20%22?pn=%22%20+%20num;%0A%09%09%09%09break;%0A%09%09%7D%0A%09%7D,%0A%09getGoUrlByFloorNum%20:%20function(num)%7B%0A%09%09if(isNaN(num))%0A%09%09%09%09%09return%20'#';%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI:%0A%09%09%09case%20PT.TB_CLASSIC:%0A%09%09%09%09var%20z=URLM.getTieziId();%0A%09%09%09%09var%20ct=URLM.getPara('ct');%0A%09%09%09%09var%20maxFloor%20=%20$p.getMaxFloorNum();%0A%09%09%09%09var%20newPn;%0A%09%09%09%09var%20fNum=FLM.getFirstFloorNumber();%0A%09%09%09%09if(num%20%3E=%20maxFloor%20&&%20num%20%3E=%20fNum+30)%7B%0A%09%09%09%09%09newPn%20=%20($p.getMaxPageNum()-2)*30;%0A%09%09%09%09%7Delse%7B%0A%09%09%09%09%09var%20pn=parseInt(URLM.getPara('pn'));%0A%09%09%09%09%09pn=!pn?0:pn;%0A%09%09%09%09%09newPn=Math.floor(num*(pn+1)/fNum)-15;%0A%09%09%09%09%09newPn=newPn%3C0?0:newPn%0A%09%09%09%09%7D%0A%09%09%09%09if(fNum%20%3C=%20num%20&&%20num%20%3C%20fNum+30)%0A%09%09%09%09%09return%20'##'+num;%0A%09%09%09%09else%0A%09%09%09%09%09return%20'http://tieba.baidu.com/f?z='+z+'&ct='+ct+'&rn=30&tn=baiduPostBrowser&pn='+newPn+'##'+num;%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_TIEZI:%0A%09%09%09%09var%20pn=parseInt(URLM.getPara('pn'));%0A%09%09%09%09pn=!pn?0:pn-1;%0A%09%09%09%09var%20fNum=FLM.getFirstFloorNumber();%0A%09%09%09%09var%20temp=%20Math.floor(num*(pn*30+1)/fNum);%0A%09%09%09%09var%20newPn%20=%20Math.floor(temp/30)+1;%0A%09%09%09%09if(fNum%20%3C=%20num%20&&%20num%20%3C%20fNum+30)%0A%09%09%09%09%09return%20'#'+num;%0A%09%09%09%09else%0A%09%09%09%09%09return%20location.pathname%20+%20%22?pn=%22%20+%20newPn%20+%20%22#%22%20+%20num;%0A%09%09%09%09break;%0A%09%09%7D%0A%09%7D%0A%7D%0Aconsole.log(%22kz:%22+URLM.getPara(%22kz%22));%EF%BB%BF////////////////////////////////////////////%0A//floor%20Manager%0AFLM%20=%20%7B%0A%09_floorHTMLFilters%20:%20%5B%5D,%0A%09%0A%09addFloorHTMLFilter%20:%20function(func)%7B%0A%09%09FLM._floorHTMLFilters.push(func)%0A%09%7D,%0A%09%0A%09//%E8%8E%B7%E5%BE%97%E6%89%80%E6%9C%89%E6%A5%BC%E5%B1%82%0A%09getBrText%20:%20function()%7B%0A%09%09if(PT.getType()%20==%20PT.TB_CLASSIC)%0A%09%09%09return%20'%5Cn';%0A%09%09else%0A%09%09%09return%20'%3Cbr%3E';%0A%09%7D,%0A%09getSpaceText%20:%20function()%7B%0A%09%09if(PT.getType()%20==%20PT.TB_CLASSIC)%0A%09%09%09return%20'%20';%0A%09%09else%0A%09%09%09return%20'&nbsp;';%0A%09%7D,%0A%09getFloors%20:%20function(doc)%7B%0A%09%09if(!doc)%0A%09%09%09doc%20=%20document;%0A%09%09var%20floors;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09floors%20=%20$cls(%22post%22,%20%22div%22,%20doc);%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09floors%20=%20$cls(%22c_post%22,%20%22table%22,%20doc);%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_TIEZI%20:%20%0A%09%09%09%09floors%20=%20$cls(%22post%22,%20%22table%22,%20doc);%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%09return%20floors;%0A%09%7D,%0A%09//%E8%8E%B7%E5%BE%97%E6%89%80%E6%9C%89%E5%88%86%E5%89%B2%E7%BA%BF%0A%09getSplits%20:%20function()%7B%0A%09%09return%20$cls(%22post_split%22,%20%22div%22);%0A%09%7D,%0A%09//%E8%AE%BE%E7%BD%AE%E6%8C%87%E5%AE%9A%E6%A5%BC%E5%B1%82%E5%86%85%E5%AE%B9%0A%09setFloorHTML%20:%20function(str,%20floor)%7B%0A%09%09FLM.getFloorHTMLNode(floor).innerHTML%20=%20str;%0A%09%7D,%0A%09//%E5%8F%96%E5%BE%97%E6%8C%87%E5%AE%9A%E6%A5%BC%E5%B1%82HTML%E5%86%85%E5%AE%B9%0A%09getFloorHTML%20:%20function(floor)%7B%0A%09%09var%20html%20=%20FLM.getFloorHTMLNode(floor).innerHTML;%0A%09%09for(var%20i=0;%20i%3C%20FLM._floorHTMLFilters.length;%20i++)%7B%0A%09%09%09html%20=%20FLM._floorHTMLFilters%5Bi%5D(html);%0A%09%09%7D%0A%09%09return%20html;%0A%09%7D,%0A%09getFloorText%20:%20function(floor)%7B%0A%09%09return%20FLM.getFloorHTMLNode(floor).textContent;%0A%09%7D,%0A%09getFloorContent%20:%20function(floor)%7B%0A%09%09if(PT.getType()%20==%20PT.TB_CLASSIC)%0A%09%09%09return%20FLM.getFloorText(floor);%0A%09%09else%0A%09%09%09return%20FLM.getFloorHTML(floor);%0A%09%7D,%0A%09//%E5%8F%96%E5%BE%97%E6%8C%87%E5%AE%9A%E6%A5%BC%E5%B1%82%E5%86%85%E5%AE%B9%E8%8A%82%E7%82%B9%0A%09getFloorHTMLNode%20:%20function(floor)%7B%0A%09%09var%20node;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09node%20=%20$tag(%22cc%22,%20floor)%5B0%5D;%0A%09%09%09%09break;%20%0A%09%09%09case%20PT.CLUB_TIEZI%20:%20%0A%09%09%09%09var%20td%20=%20$tag(%22td%22,%20floor)%5B1%5D;%0A%09%09%09%09node%20=%20$tag(%22div%22,%20td)%5B0%5D;%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%09return%20node;%0A%09%7D,%0A%09%0A%09getThreadFooter%20:%20function()%7B%0A%09%09return%20$id('thread_footer');%0A%09%7D,%0A%09//%E8%BF%BD%E5%8A%A0%E6%A5%BC%E5%B1%82%0A%09addFloor%20:%20function(floor)%7B%0A%09%09var%20split%20=%20FLM.newSplit();%0A%09%09FHM.handleFloor(floor,%20split);%0A%09%09var%20footer%20=%20FLM.getThreadFooter();%0A%09%09var%20newFloor%20=%20floor.cloneNode(true);%0A%09%09footer.parentNode.insertBefore(newFloor,%20footer);%0A%09%09footer.parentNode.insertBefore(split,%20footer);%0A%09%7D,%0A%09//%E8%BF%BD%E5%8A%A0%E5%88%86%E5%89%B2%E7%BA%BF%0A%09addSplit%20:%20function()%7B%0A%09%09var%20split%20=%20FLM.newSplit();%0A%09%09var%20footer%20=%20FLM.getThreadFooter();%0A%09%09footer.parentNode.insertBefore(split,%20footer);%0A%09%7D,%0A%09newSplit%20:%20function()%7B%0A%09%09var%20node%20=%20$cre('div');%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09node.setAttribute('class',%20'post_split');%0A%09%09%09%09node.innerHTML%20=%20'%3Cdiv%20class=%22split_line%22%3E%3C/div%3E';%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09node.style.display%20=%20%22none%22;%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_TIEZI%20:%0A%09%09%09%09node.setAttribute('class',%20'post_split');%0A%09%09%09default:;%0A%09%09%7D%0A%09%09return%20node;%0A%09%7D,%0A%09//%E8%8E%B7%E5%BE%97%E7%88%B6%E8%8A%82%E7%82%B9floor%0A%09getParentFloor%20:%20function(node)%7B%0A%09%09var%20parent%20=%20node.parentNode;%0A%09%09var%20floors%20=%20FLM.getFloors();%0A%09%09while(parent)%7B%0A%09%09%09if(FLM.isFloorNode(parent,%20floors))%0A%09%09%09%09return%20parent;%0A%09%09%09parent%20=%20parent.parentNode;%0A%09%09%7D%0A%09%09return%20null;%0A%09%7D,%0A%09%0A%09isFloorNode%20:%20function(node,%20floors)%7B%0A%09%09for(var%20i=0;%20i%3C%20floors.length;%20i++)%7B%0A%09%09%09if(floors%5Bi%5D%20==%20node)%0A%09%09%09%09return%20true;%0A%09%09%7D%0A%09%09return%20false;%0A%09%7D,%0A%09getUserId%20:%20function(floor)%7B%0A%09%09var%20id;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09var%20tds%20=%20$cls(%22author%22,%20%22td%22,%20floor);%0A%09%09%09%09if(tds.length%20%3E%200)%0A%09%09%09%09%09id%20=%20$cls(%22name%22,%20%22li%22,%20tds%5B0%5D)%5B0%5D.textContent;%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09var%20ul%20=%20$cls(%22c_author%22,%20%22ul%22,%20floor)%5B0%5D;%0A%09%09%09%09var%20li%20=%20$tag(%22li%22,%20ul)%5B0%5D;%0A%09%09%09%09if(li.getAttribute(%22class%22)%20!=%20%22uau%20anonym%22)%0A%09%09%09%09%09id%20=%20$tag(%22a%22,%20li)%5B0%5D.innerHTML;%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_TIEZI%20:%0A%09%09%09%09var%20divs%20=%20$cls(%22name%20post_link%22,%20%22div%22,%20floor);%0A%09%09%09%09if(divs)%0A%09%09%09%09%09id%20=%20divs%5B0%5D.textContent;%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%09id%20=%20id?id.trim():id;%0A%09%09console.log(%22id:%20%22+id);%0A%09%09return%20id;%0A%09%7D,%0A%09%0A%09getUserIp%20:%20function(floor)%7B%0A%09%09var%20ip;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09var%20tds%20=%20$cls(%22author_anonym%22,%20%22td%22,%20floor);%0A%09%09%09%09if(tds.length%20%3E%200)%0A%09%09%09%09%09ip%20=%20tds%5B0%5D.textContent;%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09var%20lis%20=%20$cls(%22uau%20anonym%22,%20%22li%22,%20floor);%0A%09%09%09%09if(lis.length%20%3E%200)%0A%09%09%09%09%09ip%20=%20lis%5B0%5D.textContent.substring(3);%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%09ip%20=%20ip?ip.trim():ip;%0A%09%09console.log(%22ip:%20%22+ip);%0A%09%09return%20ip;%0A%09%7D,%0A%09%0A%09getUserIdIp%20:%20function(floor)%7B%0A%09%09var%20id%20=%20FLM.getUserId(floor);%0A%09%09if(!id)%0A%09%09%09id%20=%20FLM.getUserIp(floor)%0A%09%09return%20id;%0A%09%7D,%0A%09getFirstFloorNumber%20:%20function()%7B%0A%09%09return%20FLM.getFloorNumber(FLM.getFloors()%5B0%5D);%0A%09%7D,%0A%09%0A%09getFloorNumber%20:%20function(floor)%7B%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09return%20%20parseInt($tag('p',%20floor)%5B0%5D.textContent);%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09var%20td%20=%20$cls('c_floor',%20'td',%20floor)%5B0%5D;%0A%09%09%09%09return%20parseInt(td.textContent);%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_TIEZI:%0A%09%09%09%09var%20td%20=%20$cls('floor','td',floor)%5B0%5D;%0A%09%09%09%09return%20parseInt(td.textContent);%0A%09%09%09default:;%0A%09%09%7D%0A%09%7D%0A%7D%0A%EF%BB%BF%0A//FormManager%0A//////////////////////////////////////////////%0A%09//%E8%8E%B7%E5%BE%97%E7%BC%96%E8%BE%91%E5%99%A8%E8%A1%A8%E5%8D%95%0AFOM%20=%7B%0A%09getForm%20:%20function()%7B%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_LIST%20:%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09return%20$id(%22post%22);%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_LIST%20:%20%0A%09%09%09case%20PT.CLUB_TIEZI%20:%20%0A%09%09%09%09return%20$id(%22add_post_form%22);%0A%09%09%09%09break;%0A%09%09%7D%0A%09%09return%20null;%0A%09%7D,%0A%09%0A%09getSubButton%20:%20function()%7B%0A%09%09return%20$id(%22add_post_submit%22);%0A%09%7D,%0A%09//%E5%A2%9E%E5%8A%A0%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E6%97%B6%E4%BA%8B%E4%BB%B6%0A%09addActToSub%20:%20function(actStr)%7B%0A%09%09var%20str%20=%20FOM.getForm().getAttribute(%22onsubmit%22);%0A%09%09FOM.getForm().setAttribute(%22onsubmit%22,%20actStr%20+%20str);%0A%09%7D,%0A%09//%E5%88%A0%E9%99%A4%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E6%97%B6%E4%BA%8B%E4%BB%B6%0A%09removeActInSub%20:%20function(actStr)%7B%0A%09%09var%20str%20=%20FOM.getForm().getAttribute(%22onsubmit%22);%0A%09%09FOM.getForm().setAttribute(%22onsubmit%22,%20str.replace(actStr,%20%22%22));%0A%09%7D,%0A%09%0A%09getFaceButton%20:%20function()%7B%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_LIST%20:%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09return%20$id('bdeSmileyTool');%0A%09%09%09case%20PT.CLUB_LIST%20:%20%0A%09%09%09case%20PT.CLUB_TIEZI%20:%20%0A%09%09%09%09return%20$id(%22add_post_form%22);%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%7D%0A%7D%0A%EF%BB%BFIFM%20=%20%7B%0A%09getNextUrl%20:%20function(doc)%7B%0A%09%09if(!doc)%0A%09%09%09doc%20=%20document;%0A%09%09var%20tags;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09tags%20=%20$cls(%22pagination%22,%20%22li%22,%20doc);%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_TIEZI:%0A%09%09%09%09tags%20=%20$cls(%22pagination%22,%20%22div%22,%20doc);%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09tags%20=%20$cls(%22c_pagination%22,%20%22li%22,%20doc);%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%09if(tags.length%20%3E%200)%7B%0A%09%09%09var%20as%20=%20$tag(%22a%22,tags%5B0%5D);%0A%09%09%09for(var%20i=0;%20i%3C%20as.length;%20i++)%7B%0A%09%09%09%09if(as%5Bi%5D.textContent.trim()%20==%20%22%E4%B8%8B%E4%B8%80%E9%A1%B5%22)%0A%09%09%09%09%09return%20as%5Bi%5D.href;%0A%09%09%09%7D%0A%09%09%7D%0A%09%09return%20null;%0A%09%7D,%0A%09%0A%09runIframe%20:%20function(url,onloadFunc,name)%7B%0A%09%09console.log(%22runIframe:%20%22+%22name%22+%22%20url:%22+url);%0A%09%09console.log(%22frame%20onload:%20%22+onloadFunc);%0A%09%09var%20iframe=document.getElementById(name);%0A%09%09if(iframe)%0A%09%09%09iframe.src=url;%0A%09%09else%7B%0A%09%09%09iframe=document.createElement(%22iframe%22);%0A%09%09%09iframe.src=url;%0A%09%09%09iframe.id=name;%0A%09%09%09iframe.name=name;%0A%09%09%09iframe.style.display='none';%0A%09%09%09document.body.appendChild(iframe);%0A%09%09%09IFM.addOnload(iframe,onloadFunc);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09addOnload%20:%20function(iframe,func)%7B%0A%09%09if%20(iframe.attachEvent)%7B%0A%09%09%09iframe.attachEvent(%22onload%22,%20function()%7B%0A%09%09%09%09func();%0A%09%09%09%7D);%0A%09%09%7D%20else%20%7B%0A%09%09%09iframe.onload%20=%20function()%7B%0A%09%09%09%09func();%0A%09%09%09%7D;%0A%09%09%7D%0A%09%7D,%0A%09getDoc%20:%20function(name)%7B%0A%09%09return%20window.frames%5Bname%5D.document;%0A%09%7D%0A%7D%0A%0A%0A%EF%BB%BF//////////////////////////////////////%0A//TextArea%20Manager%0ATAM%20=%20%7B%0A%09//%E8%8E%B7%E5%BE%97%E5%8F%91%E5%B8%96%E6%A1%86textarea%E8%8A%82%E7%82%B9%0A%09getEditor%20:%20function()%7B%0A%09%09var%20node;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_LIST%20:%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09node%20=$id(%22bdeTextArea%22);%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09%09node%20=%20$id(%22content%22);%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_LIST%20:%20%0A%09%09%09case%20PT.CLUB_TIEZI%20:%20%0A%09%09%09%09var%20doc%20=%20$id(%22BdEditor_iframe_mz_2%22).contentWindow.document;%0A%09%09%09%09console.log(%22tag%22);%0A%09%09%09%09var%20doc2%20=%20$tag(%22iframe%22,doc)%5B0%5D.contentWindow.document;%0A%09%09%09%09node%20=%20doc2.body;%0A%09%09%09%09break;%0A%09%09%7D%0A%09%09return%20node;%0A%09%7D,%0A%09//%E8%8E%B7%E5%BE%97%E5%8F%91%E5%B8%96%E6%A1%86%E6%96%87%E6%9C%AC%0A%09getEditorText%20:%20function()%7B%0A%09%09var%20node%20=%20TAM.getEditor();%0A%09%09if(node.tagName.toLowerCase()%20==%20%22textarea%22)%0A%09%09%09return%20node.value;%0A%09%09else%0A%09%09%09return%20node.innerHTML;%0A%09%7D,%0A%09%0A%09getStandardEditorText%20:%20function()%7B%0A%09%09var%20node%20=%20TAM.getEditor();%0A%09%09if(node.tagName.toLowerCase()%20==%20%22textarea%22)%0A%09%09%09return%20node.value;%0A%09%09else%7B%0A%09%09%09node.innerHTML%20=%20node.innerHTML.replace(/%5Cn/g,%20%22%22);%0A%09%09%09if(UA.chrome)%7B%0A%09%09%09%09var%20div%20=%20$cre(%22div%22);%0A%09%09%09%09TAM._reverse(node,%20div);%0A%09%09%09%09return%20div.innerHTML;%0A%09%09%09%7Delse%0A%09%09%09%09return%20node.innerHTML;%0A%09%09%7D%0A%09%7D,%0A%09%0A%09getPureEditorText%20:%20function()%7B%0A%09%09var%20str%20=%20TAM.getStandardEditorText();%0A%09%09if(PT.getType()%20!=%20PT.TB_CLASSIC)%7B%0A%09%09%09var%20div%20=%20$cre(%22div%22);%0A%09%09%09div.innerHTML%20=%20str;%0A%09%09%09var%20imgs%20=%20$tag('img',div);%0A%09%09%09for(var%20i=0;%20i%3Cimgs.length;%20i++)%7B%0A%09%09%09%09div.removeChild(imgs%5Bi%5D);%0A%09%09%09%7D%0A%09%09%09str%20=%20div.innerHTML;%0A%09%09%09str%20=%20str.replace(/%3Cbr%3E/g,%20'%5Cn');%0A%09%09%09str%20=%20str.replace(/&lt;/g,%20'%3C');%0A%09%09%09str%20=%20str.replace(/&gt;/g,%20'%3E');%0A%09%09%09str%20=%20str.replace(/&quot;/g,%20'%22');%0A%09%09%09str%20=%20str.replace(/&nbsp;/g,%20'%20');%0A%09%09%09str%20=%20str.replace(/&amp;/g,%20'&');%0A%09%09%7D%0A%09%09return%20str;%0A%09%7D,%0A%09%0A%09_reverse%20:%20function(node,%20div)%7B%0A%09%09for(var%20i=0;%20i%3C%20node.childNodes.length;%20i++)%7B%0A%09%09%09var%20t%20=%20node.childNodes%5Bi%5D;%0A%09%09%09var%20n%20=%20t.localName;%0A%09%09%09if(t.nodeType%20==%201%20&&%20(n%20==%20%22div%22%20%7C%7C%20n%20==%20%22font%22%20%7C%7C%20n%20==%20%22span%22))%7B%0A%09%09%09%09if(t.localName%20==%20%22div%22%20)%7B%0A%09%09%09%09%09div.appendChild($cre('br'));%0A%09%09%09%09%09if(t.innerHTML%20==%20'%3Cbr%3E')%0A%09%09%09%09%09%09continue;%0A%09%09%09%09%7D%0A%09%09%09%09TAM._reverse(t,%20div);%0A%09%09%09%7Delse%0A%09%09%09%09div.appendChild(t.cloneNode(true))%0A%09%09%7D%0A%09%7D,%0A%09//%E8%BF%BD%E5%8A%A0%E5%8F%91%E5%B8%96%E6%A1%86%E6%96%87%E6%9C%AC%0A%09addEditorText%20:%20function(str)%7B%0A%09%09if(TAM.getEditorText()%20==%20'%3Cbr%3E')%0A%09%09%09TAM.setEditorText(str);%0A%09%09else%7B%0A%09%09%09var%20node%20=%20TAM.getEditor();%0A%09%09%09if(node.tagName.toLowerCase()%20==%20%22textarea%22)%0A%09%09%09%09node.value%20=%20node.value%20+%20str;%0A%09%09%09else%0A%09%09%09%09node.innerHTML%20=%20node.innerHTML%20+%20str;%0A%09%09%7D%0A%09%7D,%0A%09//%E8%AE%BE%E7%BD%AE%E5%8F%91%E5%B8%96%E6%A1%86%E6%96%87%E6%9C%AC%0A%09setEditorText%20:%20function(str)%7B%0A%09%09var%20node%20=%20TAM.getEditor();%0A%09%09if(node.tagName.toLowerCase()%20==%20%22textarea%22)%0A%09%09%09node.value%20=%20str;%0A%09%09else%0A%09%09%09node.innerHTML%20=%20str;%0A%09%7D,%0A%09setTimeFocus%20:%20function()%7B%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09setTimeout(function%20()%20%7B%0A%09%09%09%09%09ContentInput.focus()%0A%09%09%09%09%7D,%20300)%0A%09%09%09%09break;%0A%09%09%09case%20PT.CLUB_TIEZI%20:%0A%09%09%09%09setTimeout(function%20()%20%7B%0A%09%09%09%09%09TAM.getEditor.focus()%0A%09%09%09%09%7D,%20300)%0A%09%09%09%09break;%0A%09%09%09default:%20;%0A%09%09%7D%0A%09%7D,%0A%09%0A%09addImage%20:%20function(url)%7B%0A%09%09var%20str%20=%20'%3Cimg%20class=%22BDE_Image%22%20changedsize=%22false%22%20src=%22'%20+%20url+%20'%22%3E';%0A%09%09TAM.addEditorText(str);%0A%09%09if(BdeText)%0A%09%09%09BdeText.dispatch(%22oneditorselectionchange%22);%0A%09%7D%0A%7D%0A%0AMeM%20=%7B%0A%09_onloads%20:%20%7B%7D,%0A%09%0A%09init%20:%20function()%7B%0A%09%09$id('miyureceiver').addEventListener('receive',%20MeM.handleMessages,%20false);%0A%09%7D,%0A%09handleMessages%20:%20function()%7B%0A%09%09var%20receiver%20=%20$id('miyureceiver');%0A%09%09var%20ms%20=%20$tag('message',%20receiver);%0A%09%09for(var%20i=0;%20i%3C%20ms.length;%20i++)%7B%0A%09%09%09var%20str%20=%20decodeURI(ms%5Bi%5D.innerHTML);%0A%09%09%09var%20r%20=%20JSON.parse(str);%0A%09%09%09if(MeM._onloads%5Br.id%5D)%7B%0A%09%09%09%09MeM._onloads%5Br.id%5D.onload(r.content,%20MeM._onloads%5Br.id%5D.param);%0A%09%09%09%09delete%20MeM._onloads%5Br.id%5D;%0A%09%09%09%7Delse%0A%09%09%09%09console.log('no%20onload%20named%20'+r.id);%0A%09%09%09receiver.removeChild(ms%5Bi%5D);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09postMessage%20:%20function(command,%20content,%20onload,%20param)%7B%0A%09%09var%20id%20=%20%22%22%20+%20Math.random();%0A%09%09var%20request%20=%20%7B%0A%09%09%09id%20:%20id,%0A%09%09%09command%20:%20command,%0A%09%09%09content%20:%20content%0A%09%09%7D;%0A%09%09if(onload)%0A%09%09%09MeM._onloads%5Bid%5D%20=%20%7B%0A%09%09%09%09onload%20:%20onload,%0A%09%09%09%09param%20:%20param%0A%09%09%09%7D;%0A%09%09var%20msg%20=%20$cre('message');%0A%09%09msg.innerHTML%20=%20encodeURI(JSON.stringify(request));%0A%09%09var%20sender%20=%20$id('miyusender');%0A%09%09sender.appendChild(msg);%0A%09%09var%20customEvent%20=%20document.createEvent('HTMLEvents');%0A%09%09customEvent.initEvent('send',%20true,%20true);%0A%09%09sender.dispatchEvent(customEvent);%0A%09%09setTimeout(function()%7B%0A%09%09%09delete%20MeM._onloads%5Bid%5D;%0A%09%09%7D,30000);%0A%09%7D,%0A%09%0A%09xmlhttpRequest%20:%20function(request)%7B%0A%09%09var%20onload%20=%20request.onload;%0A%09%09delete%20request.onload;%0A%09%09var%20param%20=%20request.param;%0A%09%09delete%20request.param;%0A%09%09MeM.postMessage('xhr',%20request,%20onload,%20param);%0A%09%7D,%0A%09%0A%09clearMessage%20:%20function()%7B%0A%09%09MeM.postMessage('clearXhrCache',%20null,%20null,%20null);%0A%09%7D,%0A%09%0A%09getGoogleShortUrl%20:%20function(url,%20callback)%7B%0A%09%09console.log(url);%0A%09%09MeM.xmlhttpRequest(%7B%0A%09%09%09method%20:%20'POST',%0A%09%09%09url%20:%20%22http://goo.gl/api/shorten?url=%22%20+%20encodeURIComponent(url),%0A%09%09%09data%20:%20'url='%20+%20encodeURIComponent(url),%0A%09%09%09headers:%20%7B%0A%09%09%09%09'Content-type'%20:%20'application/x-www-form-urlencoded',%0A%09%09%09%7D,%0A%09%09%09onload:%20function(r)%7B%0A%09%09%09%09var%20object%20=%20JSON.parse(r.responseText);%0A%09%09%09%09var%20pre%20=%20'http://goo.gl/';%0A%09%09%09%09var%20l%20=%20pre.length;%0A%09%09%09%09var%20str%20=%20object.short_url.substring(l);%0A%09%09%09%09callback(str);%0A%09%09%09%7D%0A%09%09%7D);%0A%09%7D%0A%7D%0AMeM.init();%0A%0A%EF%BB%BFvar%20Miyu%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_LIST,%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_LIST,%0A%09%09PT.CLUB_TIEZI%0A%09%5D,%0A%09id%20:%20'miyu',%0A%09name%20:%20'%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86',%0A%09%0A%09data%20:%20%7B%0A%09%09autoEn%20:%20false,%0A%09%09autoDe%20:%20true,%0A%09%09enPw%20:%20%221234%22,%0A%09%09dePws%20:%20%5B%0A%09%09%09%221234%22%0A%09%09%5D%0A%09%7D,%0A%09%0A%09encoded%20:%20false,%0A%09decoded%20:%20false,%0A%09backup%20:%20%22%3Cbr%3E%22,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Ctable%3E%20%3Ctr%3E%20%3Ctd%3E%20%09%3Cinput%20type=%22checkbox%22%20id=%22miyu_autoEn%22%20onchange=%22Miyu.autoEnCheckAction(this)%22%3E%E8%87%AA%E5%8A%A8%E5%8A%A0%E5%AF%86&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%3C/td%3E%20%3Ctd%3E%20%09%3Cinput%20id=%22miyu_handEn%22%20type=%22button%22%20value=%22%E6%89%8B%E5%8A%A8%E5%8A%A0%E5%AF%86%22%20onclick=%22Miyu.enAction(this)%22%3E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%3C/td%3E%20%3Ctd%3E%20%09%3Cinput%20id=%22miyu_enPw%22%20onchange=%22Miyu.enPwChangeAction(this)%22%20value=%221234%22%3E&nbsp;%3C/td%3E%20%3Ctd%3E%E5%8A%A0%E5%AF%86%E5%AF%86%E7%A0%81%EF%BC%88%E5%8F%AA%E5%8F%AF%E5%A1%AB%E5%86%991%E4%B8%AA%EF%BC%8C4-8%E4%BD%8D%E8%8B%B1%E6%96%87%E6%88%96%E6%95%B0%E5%AD%97%E6%B7%B7%E5%90%88,%E9%BB%98%E8%AE%A41234%EF%BC%89%3C/td%3E%20%3C/tr%3E%20%3Ctr%3E%20%3Ctd%3E%20%09%3Cinput%20type=%22checkbox%22%20id=%22miyu_autoDe%22%20onchange=%22Miyu.autoDeCheckAction(this)%22%3E%E8%87%AA%E5%8A%A8%E8%A7%A3%E5%AF%86%3C/td%3E%20%3Ctd%3E%20%09%3Cinput%20id=%22miyu_cancelEn%22%20type=%22button%22%20value=%22%E5%8F%96%E6%B6%88%E5%8A%A0%E5%AF%86%22%20onclick=%22Miyu.cancelEnAction(this)%22%3E%3C/td%3E%20%3Ctd%3E%20%09%3Cinput%20id=%22miyu_dePws%22%20onchange=%22Miyu.dePwsChangeAction(this)%22%20value=%221234%22%3E%3C/td%3E%20%3Ctd%3E%E8%A7%A3%E5%AF%86%E5%AF%86%E7%A0%81%EF%BC%88%E5%8F%AF%E5%A1%AB%E5%86%99%E5%A4%9A%E4%B8%AA%EF%BC%8C%E4%BB%A5%E7%A9%BA%E6%A0%BC%E9%9A%94%E5%BC%80%EF%BC%8C%E9%BB%98%E8%AE%A41234%EF%BC%89%3C/td%3E%20%3C/tr%3E';%0A%09%7D,%0A%09%0A%09setPanel%20:%20function()%7B%0A%09%09var%20d%20=%20Miyu.data;%0A%09%09$p.setBoxChecked(%22miyu_autoEn%22,%20d.autoEn);%0A%09%09$p.setBoxChecked(%22miyu_autoDe%22,%20d.autoDe);%0A%09%09$id(%22miyu_enPw%22).setAttribute(%22value%22,%20d.enPw);%0A%09%09$id(%22miyu_dePws%22).setAttribute(%22value%22,%20d.dePws.join('%20'));%0A%09%7D,%0A%09%0A%09setFloorHandler%20:%20function()%7B%0A%09%09if(Miyu.data.autoDe)%0A%09%09%09FHM.addFloorHandler(Miyu.decodeFloor);%0A%09%7D,%0A%09%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Miyu.id%20+%20%22%20start!%22);%0A%09%09Miyu.setAutoEn();%0A%09%09if(Miyu.data.autoDe)%0A%09%09%09Miyu.decodeAll();%0A%09%7D,%0A%09%0A%09save%20:%20function()%7B%0A%09%09Data.save(Miyu);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Miyu);%0A%09%09console.log(%22App%20%22%20+%20Miyu.id%20+%20%22%20loadData!%22);%0A%09%7D,%0A%09%0A%09autoEnCheckAction%20:%20function()%7B%0A%09%09Miyu.data.autoEn%20=%20!Miyu.data.autoEn;%0A%09%09Miyu.setAutoEn();%0A%09%09Miyu.setPanel();%0A%09%09Miyu.save();%0A%09%7D,%0A%09%0A%09autoDeCheckAction%20:%20function()%7B%0A%09%09Miyu.data.autoDe%20=%20!Miyu.data.autoDe;%0A%09%09if(Miyu.data.autoDe)%0A%09%09%09Miyu.decodeAll();%0A%09%09Miyu.setPanel();%0A%09%09Miyu.save();%0A%09%7D,%0A%09%0A%09setAutoEn%20:%20function()%7B%0A%09%09var%20actStr%20=%20%22Miyu.enAction();%22;%0A%09%09if(Miyu.data.autoEn)%7B%0A%09%09%09FOM.addActToSub(actStr);%0A%09%09%7Delse%7B%0A%09%09%09FOM.removeActInSub(actStr);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09enAction%20:%20function()%7B%0A%09%09if(!Miyu.encoded)%7B%0A%09%09%09Miyu.doEncode();%0A%09%09%09Miyu.encoded%20=%20true;%0A%09%09%7D%0A%09%7D,%0A%09%0A%09cancelEnAction%20:%20function()%7B%0A%09%09if(Miyu.encoded)%7B%0A%09%09%09TAM.setEditorText(Miyu.backup);%0A%09%09%09Miyu.encoded%20=%20false;%0A%09%09%7D%0A%09%7D,%0A%09%0A%09enPwChangeAction%20:%20function()%7B%0A%09%09Miyu.data.enPw%20=%20$id('miyu_enPw').value;%0A%09%09Miyu.save();%0A%09%7D,%0A%09%0A%09dePwsChangeAction%20:%20function()%7B%0A%09%09Miyu.data.dePws%20=%20$id('miyu_dePws').value.split('%20');%0A%09%09Miyu.save();%0A%09%7D,%0A%09%0A%09doEncode%20:%20function()%7B%0A%09%09var%20str%20=%20TAM.getStandardEditorText();%0A%09%09Miyu.backup%20=%20str;%0A%09%09var%20pw%20=Miyu.data.enPw;%0A%09%09if(!pw%20%7C%7C%20pw%20==%20'')%0A%09%09%09pw%20=%20Encryptor.DEFAULT_PW;%0A%09%09var%20newStr%20=%20Miyu.encryptStr(str,%20pw);%0A%09%09if(newStr.length%3E5000)%0A%09%09%09myAlert(%22%E5%86%85%E5%AE%B9%E5%A4%AA%E9%95%BF%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%8F%91%E5%B8%96%E5%B0%86%E4%B8%8D%E8%83%BD%E6%AD%A3%E5%B8%B8%E6%98%BE%E7%A4%BA%22);%0A%09%09TAM.setEditorText(newStr);%0A%09%7D,%0A%09%0A%09encryptStr%20:%20function(str,pw)%7B%0A%09%09str='miyu'+str;%0A%09%09var%20miw%20=%20null;%0A%09%09if%20(!pw%20%7C%7C%20pw.length%3C4)%7B%0A%09%09%09myAlert('%E5%8A%A0%E5%AF%86%E5%AF%86%E7%A0%81%E5%A4%AA%E7%9F%AD');%0A%09%09%7Delse%20if(pw.length%3E8)%7B%0A%09%09%09myAlert('%E5%8A%A0%E5%AF%86%E5%AF%86%E7%A0%81%E5%A4%AA%E9%95%BF');%0A%09%09%7Delse%20if(pw.indexOf('%20',0)!=-1%20%7C%7C%20pw.indexOf('#',0)!=-1%7C%7C%20pw.indexOf('*',0)!=-1)%7B%0A%09%09%09myAlert('%E5%AF%86%E7%A0%81%E4%B8%8D%E8%83%BD%E6%9C%89%E7%A9%BA%E6%A0%BC%EF%BC%8C#%EF%BC%8C*');%0A%09%09%7Delse%20if(!str%20%7C%7C%20str.length%3C5%20)%7B%0A%09%09%09;%0A%09%09%7Delse%7B%0A%09%09%09headmi=Encryptor.encrypt2('000miyu');%0A%09%09%09bodymi=Encryptor.encrypt2(str,pw);%0A%09%09%09miw='%E7%99%BE%E5%BA%A6%E5%AF%86%E8%AF%AD'+headmi+bodymi+'#';%0A%09%09%7D%0A%09%09return%20miw;%0A%09%7D,%0A%09%0A%09decodeAll%20:%20function()%7B%0A%09%09if(Miyu.decoded)%0A%09%09%09return%20;%0A%09%09var%20floors=FLM.getFloors();%0A%09%09if%20(!floors)%0A%09%09%09return%20;%0A%09%09for(var%20i=0;%20i%3C%20floors.length;%20i++)%0A%09%09%09Miyu.decodeFloor(floors%5Bi%5D);%0A%09%09Miyu.decoded%20=%20true;%0A%09%7D,%0A%09%0A%09decodeFloor%20:%20function(floor)%7B%0A%09%09var%20str%20=%20FLM.getFloorHTMLNode(floor).innerHTML.trim();%0A%09%09if(str%20==%20null%20%7C%7C%20str.length%20%3C%2027%20%7C%7C%20str.substring(0,4)%20!=%20'%E7%99%BE%E5%BA%A6%E5%AF%86%E8%AF%AD')%0A%09%09%09return%20;%0A%09%09str%20=%20str.substring(4);%0A%09%09var%20func,newFlag;%0A%09%09var%20flag%20=%20Miyu.check(str,%20true);%0A%09%09if(flag)%7B%0A%09%09%09newFlag%20=%20true;%0A%09%09%7Delse%7B%0A%09%09%09flag%20=%20Miyu.check(str,%20false);%0A%09%09%20%20%20%20if(flag)%0A%09%09%09%09newFlag%20=%20false;%0A%09%09%7D%0A%09%09if(flag)%7B%0A%09%09%09var%20deStr=%20Miyu.decryptStr(str,Miyu.data.dePws,newFlag);%0A%09%09%09var%20span%20=%20$cre(%22span%22);%0A%09%09%09if(deStr)%7B%0A%09%09%09%09FLM.setFloorHTML(deStr,%20floor);%0A%09%09%09%09span.innerHTML%20=%20'%3Cspan%20style=%22color:green%22%3E%E5%B7%B2%E8%A7%A3%E5%AF%86%3C/span%3E%20%20%E6%AD%A4%E6%A5%BC%E7%94%B1%3Ca%20href=%22http://tieba.baidu.com/f?kw=%25B0%25D9%25B6%25C8%25C3%25DC%25D3%25EF%22%3E%E7%99%BE%E5%BA%A6%E5%AF%86%E8%AF%AD%3C/a%3E%E5%8A%A0%E5%AF%86%20';%0A%09%09%09%7D%0A%09%09%09else%0A%09%09%09%09span.innerHTML='%3Cspan%20style=%22color:red%22%3E%E5%AF%86%E9%92%A5%E6%9C%AA%E7%9F%A5%3C/span%3E%20%E6%AD%A4%E6%A5%BC%E7%94%B1%3Ca%20href=%22http://tieba.baidu.com/f?kw=%25B0%25D9%25B6%25C8%25C3%25DC%25D3%25EF%22%3E%E7%99%BE%E5%BA%A6%E5%AF%86%E8%AF%AD%3C/a%3E%E5%8A%A0%E5%AF%86%20';%0A%09%09%09BARM.insertFirstItemInFloor(span,%20floor);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09decryptStr%20:%20function(str,pws,newFlag)%7B%0A%09%09var%20mingw;%0A%09%09var%20backstr;%0A%09%09if(newFlag)%7B%0A%09%09%09var%20i%20=%20str.indexOf('#');%0A%09%09%09backstr%20=%20str.substring(i+1);%0A%09%09%09str%20=%20str.substring(0,i);%0A%09%09%7D%0A%09%09for(var%20i%20in%20pws)%7B%0A%09%09%09pwi=pws%5Bi%5D;%0A%09%09%09if(!pwi%20%7C%7C%20pwi.length%3C4%20%7C%7C%20pwi.length%3E8)%0A%09%09%09%09continue;%0A%09%09%09var%20func%20=%20newFlag%20?%20Encryptor.decrypt2%20:%20Encryptor.decrypt;%0A%09%09%09var%20miw%20=%20func(str.substring(22),pwi);%0A%09%09%09if%20(miw.substring(0,4)%20==%20'miyu')%7B%0A%09%09%09%09mingw=miw.substring(4);%0A%09%09%09%09if(newFlag)%0A%09%09%09%09%09mingw%20+=%20backstr;%0A%09%09%09%09return%20mingw;%0A%09%09%09%7D%0A%09%09%7D;%0A%09%09return%20null;%0A%09%7D,%0A%09%0A%09check%20:%20function(str,%20newFlag)%7B%0A%09%09var%20func%20=%20newFlag%20?%20Encryptor.decrypt2%20:%20Encryptor.decrypt;%0A%09%09var%20ming%20=%20func(str.substring(0,22));%0A%09%09if%20(ming.substring(3,7)%20!=%20'miyu')%0A%09%09%09return%20false;%0A%09%09else%0A%09%09%09return%20true;%0A%09%7D%0A%7D%0AMyApps.add(Miyu);%0A%EF%BB%BFvar%20ChaIP%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC%0A%09%5D,%0A%09id%20:%20'chaip',%0A%09name%20:%20'%E4%B8%80%E9%94%AE%E6%9F%A5IP',%0A%09%0A%09data%20:%20%7B%0A%09%09active%20:%20true,%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22ChaIP.activeCheckAction(this)%22%20id=%22ChaIP_active%22%3E%E5%BC%80%E5%90%AF%E4%B8%80%E9%94%AE%E6%9F%A5IP%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22ChaIP_active%22,%20ChaIP.data.active);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20ChaIP.id%20+%20%22%20start!%22);%0A%09%09if(ChaIP.data.active)%7B%0A%09%09%09ChaIP.initChaIp();%0A%09%09%7D%0A%09%7D,%0A%09activeCheckAction%20:%20function()%7B%0A%09%09ChaIP.data.active%20=%20!ChaIP.data.active;%0A%09%09ChaIP.setPanel();%0A%09%09ChaIP.save();%0A%09%7D,%0A%09setFloorHandler%20:%20function()%7B%0A%09%09if(ChaIP.data.active)%7B%0A%09%09%09FHM.addFloorHandler(ChaIP.setChaIp);%0A%09%09%7D%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09Data.save(ChaIP);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(ChaIP);%0A%09%7D,%0A%09activeCheckAction%20:%20function()%7B%0A%09%09ChaIP.data.active%20=%20!ChaIP.data.active;%0A%09%09ChaIP.setPanel();%0A%09%09ChaIP.save();%0A%09%7D,%0A%09initChaIp%20:%20function()%7B%0A%09%09FHM.funcToFloors(ChaIP.setChaIp);%0A%09%7D,%0A%09setChaIp%20:%20function(floor)%7B%0A%09%09var%20p%20=%20PT.getType();%0A%09%09if(p%20==%20PT.TB_TIEZI)%7B%0A%09%09%09var%20tds%20=%20$cls(%22author_anonym%22,%20%22td%22,%20floor);%0A%09%09%09if%20(tds.length%20%3E%200)%7B%0A%09%09%09%09var%20ipNode%20=%20tds%5B0%5D.lastChild;%0A%09%09%09%09var%20a%20=%20$cre('a');%0A%09%09%09%09a.href%20=%20%22http://www.ip138.com/ips.asp?ip=%22%20+%20ipNode.nodeValue;%0A%09%09%09%09a.target%20=%20%22_blank%22;%0A%09%09%09%09a.innerHTML%20=%20ipNode.nodeValue;%0A%09%09%09%09tds%5B0%5D.replaceChild(a,%20ipNode);%0A%09%09%09%7D%0A%09%09%7Delse%20if%20(p%20==%20PT.TB_CLASSIC)%7B%0A%09%09%09var%20lis%20=%20$cls(%22uau%20anonym%22,%20%22li%22,%20floor);%0A%09%09%09if(lis.length%20%3E%200)%7B%0A%09%09%09%09var%20ip%20=%20lis%5B0%5D.innerHTML.substring(3);%0A%09%09%09%09lis%5B0%5D.innerHTML%20=%20%22%E4%BD%9C%E8%80%85%EF%BC%9A%22%20+%20'%3Ca%20target=%22_blank%22%20href=%22http://www.ip138.com/ips.asp?ip='+ip+'%22%20%3E'+ip+'%3C/a%3E'%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%0A%7D%0A%0AMyApps.add(ChaIP);%0A%EF%BB%BFvar%20Osee%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_TIEZI%0A%09%5D,%0A%09id%20:%20'osee',%0A%09name%20:%20'%E5%8F%AA%E7%9C%8B%E6%AD%A4%E4%BA%BA',%0A%09%0A%09data%20:%20%7B%0A%09%09active%20:%20true,%0A%09%09barText%20:%20%22%E5%8F%AA%E7%9C%8B%22,%0A%09%09onlySeeNow%20:%20false,%0A%09%09tieziId%20:%20%22%22,%0A%09%09userId%20:%20null,%0A%09%09userIp%20:%20null,%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22Osee.activeCheckAction(this)%22%20id=%22osee_active%22%3E%E5%BC%80%E5%90%AF%E5%8F%AA%E7%9C%8B%E6%AD%A4%E4%BA%BA&nbsp;&nbsp;&nbsp;%3Cinput%20type=%22button%22%20onclick=%22Osee.setBarTextAction()%22%20value=%22%E8%AE%BE%E7%BD%AE%E6%8C%89%E9%94%AE%22%3E%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22osee_active%22,%20Osee.data.active);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Osee.id%20+%20%22%20start!%22);%0A%09%09if(Osee.data.active)%7B%0A%09%09%09if(Osee.data.onlySeeNow)%0A%09%09%09%09Osee.setAll();%0A%09%09%09Osee.setBars();%0A%09%09%09MyPanel.addButton(%22cancelonlysee%22,%20%22%E5%8F%96%E6%B6%88%E5%8F%AA%E7%9C%8B%E6%AD%A4%E4%BA%BA%22,%20Osee.cancelAction);%0A%09%09%7D%0A%09%7D,%0A%09setFloorHandler%20:%20function()%7B%0A%09%09if(Osee.data.active)%7B%0A%09%09%09FHM.addFloorHandler(Osee.setFloor);%0A%09%09%7D%0A%09%09FHM.addFloorHandler(Osee.setBar);%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09Data.save(Osee);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Osee);%0A%09%7D,%0A%09%0A%09activeCheckAction%20:%20function()%7B%0A%09%09Osee.data.active%20=%20!Osee.data.active;%0A%09%09Osee.setPanel();%0A%09%09Osee.save();%0A%09%7D,%0A%09setBarTextAction%20:%20function()%7B%0A%09%09var%20str%20=%20prompt(%22%E8%AE%BE%E7%BD%AE%E2%80%9C%E5%8F%AA%E7%9C%8B%E6%AD%A4%E4%BA%BA%E2%80%9D%E6%8C%89%E9%94%AE%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%9A%22,%20Osee.data.barText);%0A%09%09if(str%20&&%20str.length%20%3E%200)%7B%0A%09%09%09Osee.data.barText%20=%20str;%0A%09%09%09Osee.save();%0A%09%09%7D%0A%09%7D,%0A%09onlySeeAction%20:%20function(node)%7B%0A%09%09var%20floor%20=%20FLM.getParentFloor(node);%0A%09%09Osee.data.onlySeeNow%20=%20true;%0A%09%09Osee.data.tieziId%20=%20URLM.getTieziId();%0A%09%09Osee.data.pageType%20=%20PT.getType();%0A%09%09Osee.data.userId%20=%20FLM.getUserId(floor);%0A%09%09Osee.data.userIp%20=%20FLM.getUserIp(floor);%0A%09%09Osee.setAll();%0A%09%09Osee.save();%0A%09%7D,%0A%09%0A%09cancelAction%20:%20function()%7B%0A%09%09if(!Osee.data.onlySeeNow)%0A%09%09%09return;%0A%09%09var%20splits%20=%20FLM.getSplits();%0A%09%09for(var%20i=0;%20i%3C%20splits.length;%20i++)%0A%09%09%09splits%5Bi%5D.style.display%20=%20%22%22;%0A%09%09FHM.funcToFloors(function(floor)%7B%0A%09%09%09floor.style.display%20=%20%22%22;%0A%09%09%7D);%0A%09%09Osee.data.onlySeeNow%20=%20false;%0A%09%09Osee.save();%0A%09%7D,%0A%09%0A%09setAll%20:%20function()%7B%0A%09%09var%20floors=FLM.getFloors();%0A%09%09for(var%20i=0;%20i%3C%20floors.length;%20i++)%7B%0A%09%09%09Osee.setFloor(floors%5Bi%5D);%0A%09%09%09Osee.setSplit(floors%5Bi%5D);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09ifShowFloor%20:%20function(floor)%7B%0A%09%09if(!Osee.data.onlySeeNow%20%7C%7C%20URLM.getTieziId()%20!=%20Osee.data.tieziId)%0A%09%09%09return%20true;%0A%09%09if(Osee.data.userId)%7B%0A%09%09%09var%20id%20=%20FLM.getUserId(floor);%0A%09%09%09console.log(%22OseeID:%20%22+Osee.data.userId)%0A%09%09%09console.log(%22id:%22+id);%0A%09%09%09console.log(%20'equal?:'%20+%20(id%20==%20Osee.data.userId));%0A%09%09%09return%20id%20==%20Osee.data.userId;%0A%09%09%7D%0A%09%09else%7B%0A%09%09%09var%20ip%20=%20FLM.getUserIp(floor);%0A%09%09%09console.log()%0A%09%09%09return%20ip%20&&%20ip%20==%20Osee.data.userIp;%0A%09%09%7D%0A%09%7D,%0A%09%0A%09setFloor%20:%20function(floor,%20split)%7B%0A%09%09if(!Osee.ifShowFloor(floor))%7B%0A%09%09%09floor.style.display%20=%20%22none%22;%0A%09%09%09if(split)%0A%09%09%09%09split.style.display%20=%20%22none%22;%0A%09%09%7D%0A%09%7D,%0A%09setSplit%20:%20function(floor)%7B%0A%09%09if(!Osee.ifShowFloor(floor))%7B%0A%09%09%09switch(PT.getType())%7B%0A%09%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09case%20PT.CLUB_TIEZI%20:%0A%09%09%09%09%09var%20node%20=%20floor.nextSibling;%0A%09%09%09%09%09while(!node.tagName)%0A%09%09%09%09%09%09node%20=%20node.nextSibling;%0A%09%09%09%09%09node.style.display%20=%20%22none%22;%0A%09%09%09%09default:;%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D,%0A%09%0A%09setBars%20:%20function()%7B%0A%09%09FHM.funcToFloors(Osee.setBar);%0A%09%7D,%0A%09setBar%20:%20function(floor)%7B%0A%09%09var%20span%20=%20$cre(%22span%22);%0A%09%09span.innerHTML%20=%20'%3Ca%20href=%22##%22%20onclick=%22Osee.onlySeeAction(this)%22%3E'%20+%20Osee.data.barText%20+%20'%3C/a%3E'%0A%09%09BARM.addItemInFloor(span,%20floor);%0A%09%7D%0A%7D%0AMyApps.add(Osee);%0A%EF%BB%BFvar%20Okey%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_TIEZI%0A%09%5D,%0A%09id%20:%20'okey',%0A%09name%20:%20'%E4%B8%80%E9%94%AE%E5%88%B0%E5%BA%95',%0A%09iframeName%20:%20'onekeyiframe',%0A%09%0A%09doc:%20document,%0A%09%0A%09data%20:%20%7B%0A%09%09active%20:%20true,%0A%09%09onekeydown%20:%20false%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22Okey.activeCheckAction(this)%22%20id=%22Okey_active%22%3E%E5%BC%80%E5%90%AF%E4%B8%80%E9%94%AE%E5%88%B0%E5%BA%95%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22Okey_active%22,%20Okey.data.active);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Okey.id%20+%20%22%20start!%22);%0A%09%09if(Okey.data.active)%7B%0A%09%09%09MyPanel.addButton(%22onekeydown%22,%20%22%E4%B8%80%E9%94%AE%E5%88%B0%E5%BA%95%22,%20Okey.onekeydownAction);%0A%09%09%7D%0A%09%7D,%0A%09setFloorHandler%20:%20function()%7B%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09Data.save(Okey);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Okey);%0A%09%7D,%0A%09%0A%09activeCheckAction%20:%20function()%7B%0A%09%09Okey.data.active%20=%20!Okey.data.active;%0A%09%09Okey.setPanel();%0A%09%09Okey.save();%0A%09%7D,%0A%09onekeydownAction%20:%20function()%7B%0A%09%09Okey.data.onekeydown%20=%20!Okey.data.onekeydown;%0A%09%09if(Okey.data.onekeydown)%0A%09%09%09$id('onekeydown').value%20=%20%22%E6%9A%82%E5%81%9C%22;%0A%09%09else%0A%09%09%09$id('onekeydown').value%20=%20%22%E7%BB%A7%E7%BB%AD%22;%0A%09%09Okey.oneKeyDown(Okey.doc);%0A%09%7D,%0A%09%0A%09oneKeyDown%20:%20function(doc)%7B%0A%09%09if(!Okey.data.onekeydown)%0A%09%09%09return;%0A%09%09var%20nextUrl=IFM.getNextUrl(doc);%0A%09%09%09if(!nextUrl)%7B%0A%09%09%09%09var%20info%20=%20%22%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%AF%95!%22;%0A%09%09%09%09$id('onekeydown').value%20=%20info;%0A%09%09%09%09$id('onekeydown').disabled%20=%20%22disabled%22;%0A%09%09%09%09myAlert(info);%0A%09%09%09%09return;%0A%09%09%7D%0A%09%09IFM.runIframe(nextUrl,%20window.parent.Okey.callback,%20Okey.iframeName);%0A%09%7D,%0A%0A%09callback%20:%20function()%7B%0A%09%09var%20doc%20=%20IFM.getDoc(Okey.iframeName);%0A%09%09var%20newFloors%20=%20FLM.getFloors(doc);%0A%09%09for(var%20i%20=%200;%20i%20%3C%20newFloors.length;%20i++)%0A%09%09%09FLM.addFloor(newFloors%5Bi%5D);%0A%09%09Okey.doc%20=%20doc;%0A%09%09Okey.oneKeyDown(doc);%0A%09%7D%0A%7D%0AMyApps.add(Okey);%0A%EF%BB%BFvar%20Ogo%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_TIEZI%0A%09%5D,%0A%09id%20:%20'Ogo',%0A%09name%20:%20'%E4%B8%80%E9%94%AE%E8%B7%B3%E8%BD%AC',%0A%09%0A%09data%20:%20%7B%0A%09%09replyActive%20:%20true,%0A%09%09textActive%20:%20true,%0A%09%09searchActive%20:%20true,%0A%09%09barText%20:%20'Go!'%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22Ogo.replyCheckAction(this)%22%20id=%22Ogo_reply%22%3E%E5%BC%80%E5%90%AF%E5%9B%9E%E5%A4%8D%E8%B7%B3%E8%BD%AC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%3Cinput%20type=%22checkbox%22%20onchange=%22Ogo.textCheckAction(this)%22%20id=%22Ogo_text%22%3E%E5%BC%80%E5%90%AF%E6%96%87%E6%9C%AC%E8%AF%86%E5%88%AB%E8%B7%B3%E8%BD%AC&nbsp;&nbsp;&nbsp;%3Cinput%20type=%22button%22%20onclick=%22Ogo.setBarTextAction()%22%20value=%22%E8%AE%BE%E7%BD%AE%E6%8C%89%E9%94%AE%22%3E&nbsp;&nbsp;%3Cinput%20type=%22checkbox%22%20onchange=%22Ogo.searchCheckAction(this)%22%20id=%22Ogo_search%22%3E%E5%BC%80%E5%90%AF%E6%90%9C%E7%B4%A2%E6%A0%8F%E8%B7%B3%E8%BD%AC%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22Ogo_reply%22,%20Ogo.data.replyActive);%0A%09%09$p.setBoxChecked(%22Ogo_text%22,%20Ogo.data.textActive);%0A%09%09$p.setBoxChecked(%22Ogo_search%22,%20Ogo.data.searchActive);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Ogo.id%20+%20%22%20start!%22);%0A%09%09if(Ogo.data.replyActive)%7B%0A%09%09%09Ogo.initReplyGo();%0A%09%09%7D%0A%09%09if(Ogo.data.textActive)%7B%0A%09%09%09Ogo.initTextGo();%0A%09%09%7D%0A%09%09if(Ogo.data.searchActive)%7B%0A%09%09%09Ogo.initSearchGo();%0A%09%09%7D%0A%09%09if(Ogo.data.replyActive%20%7C%7C%20Ogo.data.textActive%20%7C%7C%20Ogo.data.searchActive)%0A%09%09%09Ogo.checkGo();%0A%09%7D,%0A%09setFloorHandler%20:%20function()%7B%0A%09%09if(Ogo.data.replyActive)%7B%0A%09%09%09FHM.addFloorHandler(Ogo.setReplyGo);%0A%09%09%7D%0A%09%09if(Ogo.data.textActive)%7B%0A%09%09%09FHM.addFloorHandler(Ogo.setTextGo);%0A%09%09%7D%0A%09%7D,%0A%09setFloorHTMLFilter%20:%20function()%7B%0A%09%09FLM.addFloorHTMLFilter(Ogo.delReplyGoLink);%0A%09%7D,%0A%09delReplyGoLink%20:%20function(html)%7B%0A%09%09var%20div%20=%20$cre('div');%0A%09%09div.innerHTML%20=%20html;%0A%09%09var%20links%20=%20$tag('a',div);%0A%09%09var%20flag%20=%20true;%0A%09%09while(flag)%7B%0A%09%09%09flag%20=%20false;%0A%09%09%09for(var%20i%20=%200;%20i%20%3C%20links.length;%20i++%20)%7B%0A%09%09%09%09var%20a%20=%20links%5Bi%5D;%0A%09%09%09%09if(a.getAttribute('onclick'))%7B%0A%09%09%09%09%09var%20t%20=%20document.createTextNode(a.innerHTML);%0A%09%09%09%09%09a.parentNode.replaceChild(t,a);%0A%09%09%09%09%09flag%20=%20true;%0A%09%09%09%09%09break;%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%09links%20=%20$tag('a',div);%0A%09%09%7D%0A%09%09return%20div.innerHTML;%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09Data.save(Ogo);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Ogo);%0A%09%7D,%0A%09replyCheckAction%20:%20function()%7B%0A%09%09Ogo.data.replyActive%20=%20!Ogo.data.replyActive;%0A%09%09Ogo.setPanel();%0A%09%09Ogo.save();%0A%09%7D,%0A%09textCheckAction%20:%20function()%7B%0A%09%09Ogo.data.textActive%20=%20!Ogo.data.textActive;%0A%09%09Ogo.setPanel();%0A%09%09Ogo.save();%0A%09%7D,%0A%09searchCheckAction%20:%20function()%7B%0A%09%09Ogo.data.searchActive%20=%20!Ogo.data.searchActive;%0A%09%09Ogo.setPanel();%0A%09%09Ogo.save();%0A%09%7D,%0A%09setBarTextAction%20:%20function()%7B%0A%09%09var%20str%20=%20prompt(%22%E8%AE%BE%E7%BD%AE%E2%80%9C%E6%96%87%E6%9C%AC%E8%AF%86%E5%88%AB%E8%B7%B3%E8%BD%AC%E2%80%9D%E6%8C%89%E9%94%AE%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%9A%22,%20Ogo.data.barText);%0A%09%09if(str%20&&%20str.length%20%3E%200)%7B%0A%09%09%09Ogo.data.barText%20=%20str;%0A%09%09%09Ogo.save();%0A%09%09%7D%0A%09%7D,%0A%09initReplyGo%20:%20function()%7B%0A%09%09FHM.funcToFloors(Ogo.setReplyGo);%0A%09%7D,%0A%09getGoLink%20:%20function(num)%7B%0A%09%09return%20'%3Ca%20href=%22##%22%20onclick=%22Ogo.basicGo(%5C''+num+'%5C');%22%3E'%20+%20num%20+'%3C/a%3E';%0A%09%7D,%0A%09setReplyGo%20:%20function(floor)%7B%0A%09%09var%20str%20=%20FLM.getFloorHTMLNode(floor).innerHTML;%0A%09%09var%20i%20=%20str.indexOf('%E5%9B%9E%E5%A4%8D%EF%BC%9A')%0A%09%09while(i%20!=%20-1)%7B%0A%09%09%09var%20j%20=%20str.indexOf('%E6%A5%BC',%20i);%0A%09%09%09if(j%20==%20-1)%7B%0A%09%09%09%09break;%0A%09%09%09%7Delse%7B%0A%09%09%09%09var%20numStr=str.substring(i%20+%203,%20j);%0A%09%09%09%09var%20num=parseInt(numStr);%0A%09%09%09%09if(!isNaN(num))%7B%0A%09%09%09%09%09var%20str%20=%20str.substring(0,%20i)%20+%20'%E5%9B%9E%E5%A4%8D%EF%BC%9A'+%20Ogo.getGoLink(num)%20+'%E6%A5%BC'+str.substring(j%20+%201);%0A%09%09%09%09%7D%0A%09%09%09%09i%20=%20str.indexOf('%E5%9B%9E%E5%A4%8D%EF%BC%9A',%20j);%0A%09%09%09%7D%0A%09%09%7D%0A%09%09FLM.setFloorHTML(str,%20floor);%0A%09%7D,%0A%09%0A%09%0A%09initTextGo%20:%20function()%7B%0A%09%09FHM.funcToFloors(Ogo.setTextGo);%0A%09%7D,%0A%09setTextGo%20:%20function(floor)%7B%0A%09%09var%20span%20=%20$cre('span');%0A%09%09span.innerHTML%20=%20'%3Ca%20onclick=%22Ogo.textGoAction();%22%20href=%22##%22%3E'%20+%20Ogo.data.barText%20+%20'%3C/a%3E';%0A%09%09BARM.addItemInFloor(span,%20floor);%0A%09%7D,%0A%09textGoAction%20:%20function()%7B%0A%09%09var%20str%20=%20window.getSelection().toString();%0A%09%09Ogo.basicGo(str);%0A%09%7D,%0A%09%0A%09%0A%09initSearchGo%20:%20function()%7B%0A%09%09var%20div%20=%20$tag('div',%20$id('header'))%5B3%5D;%0A%09%09var%20s='&nbsp;%7C&nbsp;%3Ca%20onclick=%22Ogo.searchGoAction();%22%20href=%22##%22%3EGo!%3C/a%3E';%0A%09%09div.innerHTML=div.innerHTML+s;%0A%09%7D,%0A%09searchGoAction%20:%20function()%7B%0A%09%09var%20input%20=%20$p.getSearchInput();%0A%09%09Ogo.basicGo(input.value);%0A%09%7D,%0A%09%0A%09%0A%09basicGo%20:%20function(str)%7B%0A%09%09var%20num%20=%20Ogo.parseInt(str);%0A%09%09var%20url%20=%20URLM.getGoUrlByFloorNum(num);%0A%09%09console.log(%22basic%20Go:%20%22+url);%0A%09%09location.href%20=%20url;%0A%09%7D,%0A%09%0A%09parseInt%20:%20function(str)%7B%0A%09%09var%20num;%0A%09%09for(var%20j%20=%200;%20j%20%3C%20str.length;%20j++)%7B%0A%09%09%09if(str.charAt(j)%20==%20'-')%0A%09%09%09%09continue;%0A%09%09%09num%20=%20parseInt(str.substring(j));%0A%09%09%09if(!isNaN(num))%0A%09%09%09%09break;%0A%09%09%7D%0A%09%09return%20num;%0A%09%7D,%0A%09%0A%09checkGo%20:%20function()%7B%0A%09%09var%20split%20;%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_CLASSIC%20:%0A%09%09%09case%20PT.TB_TIEZI%20:%0A%09%09%09%09split%20=%20'##';%0A%09%09%09%09break;%20%0A%09%09%09case%20PT.CLUB_TIEZI%20:%20%0A%09%09%09%09split%20=%20'#';%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%09var%20a%20=%20location.href;%0A%09%09var%20i%20=%20a.indexOf(split);%0A%09%09var%20l%20=%20split.length;%0A%09%09if(i==-1%20%7C%7C%20(i%20+%20l)%20==%20a.length)%0A%09%09%09return;%0A%09%09var%20numStr=a.substring(i%20+%20l);%0A%09%09if(numStr.length%3E7)%0A%09%09%09return;%0A%09%09var%20num%20=%20parseInt(numStr);%0A%09%09var%20fNum%20=%20FLM.getFirstFloorNumber();%0A%09%09if%20(fNum%20%3E%20num%20%7C%7C%20fNum+29%20%3C%20num)%0A%09%09%09Ogo.basicGo(a.substring(i+l));%0A%09%7D%0A%7D%0AMyApps.add(Ogo);%0A%EF%BB%BFvar%20Ref%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_TIEZI%0A%09%5D,%0A%09id%20:%20'Ref',%0A%09name%20:%20'%E5%BC%95%E7%94%A8%E9%98%9F%E5%BD%A2',%0A%09LINE_STR%20:%20'-----------------------------------------------',%0A%09%0A%09data%20:%20%7B%0A%09%09yinyongActive%20:%20true,%0A%09%09duixingActive%20:%20true,%0A%09%09yyBarText%20:%20%22%E5%BC%95%E7%94%A8%22,%0A%09%09dxBarText%20:%20%22%E9%98%9F%E5%BD%A2%22%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22Ref.yinyongCheckAction(this)%22%20id=%22Ref_yinyong%22%3E%E5%BC%80%E5%90%AF%E5%BC%95%E7%94%A8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;%3Cinput%20type=%22button%22%20onclick=%22Ref.setYyBarTextAction()%22%20value=%22%E8%AE%BE%E7%BD%AE%E6%8C%89%E9%94%AE%22%3E%3C/div%3E%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22Ref.duixingCheckAction(this)%22%20id=%22Ref_duixing%22%3E%E5%BC%80%E5%90%AF%E9%98%9F%E5%BD%A2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;%3Cinput%20type=%22button%22%20onclick=%22Ref.setDxBarTextAction()%22%20value=%22%E8%AE%BE%E7%BD%AE%E6%8C%89%E9%94%AE%22%3E%3C/div%3E%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22Ref_duixing%22,%20Ref.data.duixingActive);%0A%09%09$p.setBoxChecked(%22Ref_yinyong%22,%20Ref.data.yinyongActive);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Ref.id%20+%20%22%20start!%22);%0A%09%09if(Ref.data.yinyongActive)%7B%0A%09%09%09Ref.initYinYong();%0A%09%09%7D%0A%09%09if(Ref.data.duixingActive)%7B%0A%09%09%09Ref.initDuiXing();%0A%09%09%7D%0A%09%7D,%0A%09setFloorHandler%20:%20function()%7B%0A%09%09if(Ref.data.yinyongActive)%7B%0A%09%09%09FHM.addFloorHandler(Ref.setYinYong);%0A%09%09%7D%0A%09%09if(Ref.data.duixingActive)%7B%0A%09%09%09FHM.addFloorHandler(Ref.setDuiXing);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09save%20:%20function()%7B%0A%09%09Data.save(Ref);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Ref);%0A%09%7D,%0A%09yinyongCheckAction%20:%20function()%7B%0A%09%09Ref.data.yinyongActive%20=%20!Ref.data.yinyongActive;%0A%09%09Ref.setPanel();%0A%09%09Ref.save();%0A%09%7D,%0A%09duixingCheckAction%20:%20function()%7B%0A%09%09Ref.data.duixingActive%20=%20!Ref.data.duixingActive;%0A%09%09Ref.setPanel();%0A%09%09Ref.save();%0A%09%7D,%0A%09setYyBarTextAction%20:%20function()%7B%0A%09%09var%20str%20=%20prompt(%22%E8%AE%BE%E7%BD%AE%E2%80%9C%E5%BC%95%E7%94%A8%E2%80%9D%E6%8C%89%E9%94%AE%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%9A%22,%20Ref.data.yyBarText);%0A%09%09if(str%20&&%20str.length%20%3E%200)%7B%0A%09%09%09Ref.data.yyBarText%20=%20str;%0A%09%09%09Ref.save();%0A%09%09%7D%0A%09%7D,%0A%09setDxBarTextAction%20:%20function()%7B%0A%09%09var%20str%20=%20prompt(%22%E8%AE%BE%E7%BD%AE%E2%80%9C%E9%98%9F%E5%BD%A2%E2%80%9D%E6%8C%89%E9%94%AE%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%9A%22,%20Ref.data.dxBarText);%0A%09%09if(str%20&&%20str.length%20%3E%200)%7B%0A%09%09%09Ref.data.dxBarText%20=%20str;%0A%09%09%09Ref.save();%0A%09%09%7D%0A%09%7D,%0A%09initYinYong%20:%20function()%7B%0A%09%09FHM.funcToFloors(Ref.setYinYong);%0A%09%7D,%0A%09%0A%09initDuiXing%20:%20function()%7B%0A%09%09FHM.funcToFloors(Ref.setDuiXing);%0A%09%7D,%0A%09%0A%09setYinYong%20:%20function(floor)%7B%0A%09%09var%20span%20=%20$cre('span');%0A%09%09span.innerHTML%20=%20'%3Ca%20onclick=%22Ref.yinYongAction(this)%22%20href=%22#sub%22%3E'%20+%20Ref.data.yyBarText%20+%20'%3C/a%3E';%0A%09%09BARM.addItemInFloor(span,%20floor);%0A%09%7D,%0A%09setDuiXing%20:%20function(floor)%7B%0A%09%09var%20span%20=%20$cre('span');%0A%09%09span.innerHTML%20=%20'%3Ca%20onclick=%22Ref.duiXingAction(this)%22%20href=%22#sub%22%3E'%20+%20Ref.data.dxBarText%20+%20'%3C/a%3E';%0A%09%09BARM.addItemInFloor(span,%20floor);%0A%09%7D,%0A%09%0A%09yinYongAction%20:%20function(node)%7B%0A%09%09var%20floor%20=%20FLM.getParentFloor(node);%0A%09%09var%20str%20=%20FLM.getFloorContent(floor);%0A%09%09var%20br%20=%20FLM.getBrText();%0A%09%09var%20space%20=%20FLM.getSpaceText();%0A%09%09var%20newStr=%22%22;%0A%09%09var%20begin=0;%0A%09%09var%20i=str.indexOf(br);%0A%09%09while(i%3E-1)%7B%0A%09%09%09newStr%20+=%20str.substring(begin,i)%20+%20br%20+%20space%20+%20space;%0A%09%09%09begin%20=%20i%20+%204;%0A%09%09%09var%20i%20=%20str.indexOf(br,%20begin);%0A%09%09%7D%0A%09%09str%20=%20newStr+str.substring(begin);%0A%09%09var%20id%20=%20FLM.getUserId(floor);%0A%09%09if%20(!id)%0A%09%09%09id%20=%20FLM.getUserIp(floor);%0A%09%09str%20=%20%22%E5%BC%95%E7%94%A8%EF%BC%9A%22+FLM.getFloorNumber(floor)+%22%E6%A5%BC%20%22%20+%20space%20+%20%22(%20%22+id+%22%20)%22%20+%20br%20+%20br%20+%20space%20+%20space%20+%20str;%0A%09%09if(str.substring(str.length-12)%20==%20(space%20+%20space))%0A%09%09%09str=str.substring(0,str.length-12);%0A%09%09if(str.substring(str.length-4)%20!=%20br)%0A%09%09%09str%20+=%20br;%0A%09%09str%20+=%20Ref.LINE_STR%20+%20br;%0A%09%09TAM.addEditorText(str);%0A%09%09TAM.setTimeFocus();%0A%09%7D,%0A%09duiXingAction%20:%20function(node)%7B%0A%09%09var%20floor%20=%20FLM.getParentFloor(node);%0A%09%09var%20str%20=%20FLM.getFloorContent(floor);%0A%09%09TAM.addEditorText(str);%0A%09%09TAM.setTimeFocus();%0A%09%7D%0A%7D%0AMyApps.add(Ref);%0A%EF%BB%BFvar%20Txt%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_TIEZI%0A%09%5D,%0A%09id%20:%20'Txt',%0A%09name%20:%20'%E6%8F%90%E5%8F%96%E6%96%87%E6%9C%AC',%0A%09LINE_STR%20:%20'-----------------------------------------------',%0A%09iframeName%20:%20'copyFloors',%0A%09data%20:%20%7B%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22button%22%20onclick=%22Txt.copyAction()%22%20value=%22%E6%95%B4%E7%90%86%E5%8F%91%E8%A8%80%E5%86%85%E5%AE%B9%22%3E&nbsp;&nbsp;&nbsp;%3Cinput%20type=%22button%22%20onclick=%22Txt.extractEmailAction()%22%20value=%22%E6%8F%90%E5%8F%96%E9%82%AE%E7%AE%B1%E5%9C%B0%E5%9D%80%22%3E%3C/div%3E';%0A%09%7D,%0A%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Txt.id%20+%20%22%20start!%22);%0A%09%7D,%0A%09setFloorHandler%20:%20function()%7B%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09Data.save(Txt);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Txt);%0A%09%7D,%0A%09copyAction%20:%20function()%7B%0A%09%09Txt.copyDoc(document);%0A%09%09Txt.loopCopyDoc(document);%0A%09%7D,%0A%09copyDoc%20:%20function(doc)%7B%0A%09%09var%20fs%20=%20FLM.getFloors(doc);%0A%09%09var%20br%20=%20FLM.getBrText();%0A%09%09for(var%20i=0;i%3C%20fs.length;i++)%7B%0A%09%09%09var%20f%20=%20fs%5Bi%5D;%0A%09%09%09if(Osee.data.onlySeeNow%20&&%20!Osee.ifShowFloor(f))%0A%09%09%09%09continue;%0A%09%09%09var%20id%20=%20FLM.getUserIdIp(f);%0A%09%09%09var%20num%20=%20FLM.getFloorNumber(f);%0A%09%09%09var%20str%20=%20num%20+%20%22%E6%A5%BC%22+%22%20%20%20%20%22+id;%0A%09%09%09str%20+=%20br%20+%20br%20+%20FLM.getFloorContent(f)%20+%20br%20+%20Txt.LINE_STR%20+%20br;%0A%09%09%09TAM.addEditorText(str+';');%0A%09%09%7D%0A%09%7D,%0A%09loopCopyDoc%20:%20function(doc)%7B%0A%09%09var%20nextUrl%20=%20IFM.getNextUrl(doc);%0A%09%09if(!nextUrl)%7B%0A%09%09%09myAlert(%22%E5%8F%91%E8%A8%80%E6%95%B4%E7%90%86%E5%AE%8C%E6%AF%95!%22);%0A%09%09%09return;%0A%09%09%7D%0A%09%09IFM.runIframe(nextUrl,%20window.parent.Txt.onloadCopy,%20Txt.iframeName);%0A%09%7D,%0A%09onloadCopy%20:%20function()%7B%0A%09%09var%20doc%20=%20IFM.getDoc(Txt.iframeName);%0A%09%09Txt.copyDoc(doc);%0A%09%09Txt.loopCopyDoc(doc);%0A%09%7D,%0A%09extractEmailAction%20:%20function()%7B%0A%09%09Txt.extractThem(document);%0A%09%09Txt.loopExtractEmail(document);%0A%09%7D,%0A%09loopExtractEmail%20:%20function(doc)%7B%0A%09%09var%20nextUrl%20=%20IFM.getNextUrl(doc);;%0A%09%09if(!nextUrl)%7B%0A%09%09%09myAlert(%22%E9%82%AE%E7%AE%B1%E6%8F%90%E5%8F%96%E5%AE%8C%E6%AF%95!%22);%0A%09%09%09return;%0A%09%09%7D%0A%09%09IFM.runIframe(nextUrl,%20window.parent.Txt.onloadExtractEmail,%20Txt.iframeName);%0A%09%7D,%0A%09onloadExtractEmail%20:%20function()%7B%0A%09%09var%20doc%20=%20IFM.getDoc(Txt.iframeName);%0A%09%09Txt.extractThem(doc);%0A%09%09Txt.loopExtractEmail(doc);%0A%09%7D,%0A%09extractThem%20:%20function(doc)%7B%0A%09%09var%20fs%20=%20FLM.getFloors(doc);%0A%09%09for(var%20i=0;i%3C%20fs.length;i++)%7B%0A%09%09%09var%20f%20=%20fs%5Bi%5D;%0A%09%09%09var%20str%20=%20FLM.getFloorHTML(f);%0A%09%09%09var%20emails%20=%20Txt.deepExtractEmail(str);%0A%09%09%09if(emails)%0A%09%09%09%09TAM.addEditorText(emails);%0A%09%09%7D%0A%09%7D,%0A%09deepExtractEmail%20:%20function(str)%7B%0A%09%09var%20emails=str.match(/((%5B0-9a-zA-Z%5D+)%7C(%5B0-9a-zA-Z%5D+%5B_.0-9a-zA-Z-%5D*%5B0-9a-zA-Z%5D+))@(%5Ba-zA-Z0-9-%5D+%5B.%5D)+(net%7Ccom%7Cgov%7Cmil%7Corg%7Cedu%7Cint%7Cname%7Ccom.cn%7Cnet.cn%7Ccn%7Ccc)/g);%0A%09%09if(emails)%7B%0A%09%09%09emails%20=%20emails.join(';');%0A%09%09%09emails%20+=%20';';%0A%09%09%7D%0A%09%09return%20emails;%0A%09%7D%0A%7D%0AMyApps.add(Txt);%0A%EF%BB%BFHkey%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_TIEZI,%0A%09%09PT.CLUB_LIST%0A%09%5D,%0A%09id%20:%20'Hkey',%0A%09name%20:%20'%E5%BF%AB%E6%8D%B7%E9%94%AE',%0A%09lastText%20:%20%22%E4%B8%8A%E4%B8%80%E9%A1%B5%22,%0A%09nextText%20:%20%22%E4%B8%8B%E4%B8%80%E9%A1%B5%22,%0A%09%0A%09data%20:%20%7B%0A%09%09active%20:%20true,%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22Hkey.activeCheckAction(this)%22%20id=%22Hkey_active%22%3E%E5%BC%80%E5%90%AF%E5%BF%AB%E6%8D%B7%E9%94%AE%EF%BC%88Ctrl%20+%20Enter%E5%9B%9E%E5%A4%8D%EF%BC%8C%E5%B7%A6%E5%8F%B3%E9%94%AE%E7%BF%BB%E9%A1%B5%EF%BC%89%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22Hkey_active%22,%20Hkey.data.active);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Hkey.id%20+%20%22%20start!%22);%0A%09%09if(Hkey.data.active)%7B%0A%09%09%09Hkey.initHkey();%0A%09%09%7D%0A%09%7D,%0A%09setFloorHandler%20:%20function()%7B%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09Data.save(Hkey);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Hkey);%0A%09%7D,%0A%09activeCheckAction%20:%20function()%7B%0A%09%09Hkey.data.active%20=%20!Hkey.data.active;%0A%09%09Hkey.setPanel();%0A%09%09Hkey.save();%0A%09%7D,%0A%09initHkey%20:%20function()%7B%0A%09%09document.onkeydown%20=%20Hkey.checkKey;%0A%09%7D,%0A%09checkKey%20:%20function(e)%7B%0A%09%09var%20e%20=%20window.event%7C%7Ce;%0A%09%09var%20k%20=%20e.keyCode;%0A%09%09if(e.ctrlKey%20&&%20k%20==%2013)%0A%09%09%09Hkey.submitAction();%0A%09%09else%20if(e.ctrlKey%20%7C%7C%20e.shiftKey%20%7C%7C%20e.altKey%20%7C%7C%20e.metaKey)%0A%09%09%09return%20;%0A%09%09else%20%7B%0A%09%09%09if(Hkey.checkTextArea(e.target))%0A%09%09%09%09return%20;%0A%09%09%09else%20if(k%20==%2037)%0A%09%09%09%09Hkey.lastPageAction();%0A%09%09%09else%20if(k%20==%2039)%0A%09%09%09%09Hkey.nextPageAction();%0A%09%09%7D%0A%09%7D,%0A%09submitAction%20:%20function()%7B%0A%09%09FOM.getSubButton().click();%0A%09%7D,%0A%09lastPageAction%20:%20function()%7B%0A%09%09var%20a%20=%20Hkey.getLinkByText(Hkey.lastText);%0A%09%09if(a)%0A%09%09%09location.href%20=%20a.href;%0A%09%7D,%0A%09nextPageAction%20:%20function()%7B%0A%09%09var%20a%20=%20Hkey.getLinkByText(Hkey.nextText);%0A%09%09if(a)%0A%09%09%09location.href%20=%20a.href;%0A%09%7D,%0A%09%0A%09getLinkByText%20:%20function(str)%7B%0A%09%09var%20query%20;%0A%09%09if(PT.getType()%20==%20PT.TB_CLASSIC)%0A%09%09%09query%20=%20%22//a%5B(font/text()='%22%20+%20str%20+%20%22')%5D%22%20;%0A%09%09else%0A%09%09%09query%20=%20%22//a%5B(text()='%22%20+%20str%20+%20%22')%5D%22%20;%0A%09%09var%20nodes%20=%20Hkey.xpath(query);%0A%09%09if(nodes.snapshotLength%20%3E%200)%0A%09%09%09return%20nodes.snapshotItem(0);%0A%09%7D,%0A%09xpath%20:%20function(query)%7B%0A%09%09return%20document.evaluate(query,%20document,%20null,%0A%09%09XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,%20null);%0A%09%7D,%0A%09checkTextArea%20:%20function(node)%7B%0A%09%09var%20name%20=%20node.localName.toLowerCase();%0A%09%09if%20(name%20==%20'textarea'%20%7C%7C%20name%20==%20'input'%20%7C%7C%20name%20==%20'select')%0A%09%09%09return%20true;%0A%09%09if(name%20==%20'div'%20&&%20node.id.toLowerCase().indexOf('textarea')!=-1)%0A%09%09%09return%20true;%0A%09%09return%20false;%0A%09%7D%0A%7D%0AMyApps.add(Hkey);%0A%EF%BB%BFvar%20Face%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_LIST,%0A%09%09PT.TB_TIEZI%0A%09%5D,%0A%09id%20:%20'face',%0A%09name%20:%20'%E5%AF%86%E8%AF%AD%E8%A1%A8%E6%83%85',%0A%09%0A%09data%20:%20%7B%0A%09%09active%20:%20true,%0A%09%09albums%20:%20%5B%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E6%B4%8B%E8%91%B1%E5%A4%B4'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E6%82%A0%E5%98%BB%E7%8C%B4'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E9%98%BF%E7%8B%B8'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E6%B0%94%E6%B3%A1%E7%86%8A'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E8%98%91%E8%8F%87%E7%82%B9%E7%82%B9'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E7%82%AE%E7%82%AE%E5%85%B5'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E8%80%81%E8%99%8E'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E5%B0%8F%E7%81%B0%E8%84%B8'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E5%8A%A8%E6%80%81%E7%AC%A6%E5%8F%B7'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E5%8F%A4%E7%94%B0%E5%85%94%E5%AD%90'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'kaka%E5%A6%B9%E5%A6%B9'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E7%8C%A5%E7%90%90%E8%80%81%E6%B2%99'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E9%AD%82%E5%84%BF%E5%96%B5%E5%96%B5'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E7%8C%A5%E7%90%90%E7%8C%AB'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E7%9E%AA%E8%B0%81%E8%B0%81'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E9%87%91%E9%A6%86%E9%95%BF'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E7%8C%A5%E7%90%90%E7%8C%ABps'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E6%91%94%E4%B8%9C%E8%A5%BF'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E9%98%BF%E5%B8%83'%0A%09%09%7D,%7B%0A%09%09%09id%20:%20'matrox',%0A%09%09%09name%20:%20'%E9%9D%A2%E7%98%AB'%0A%09%09%7D%5D%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%20%3Cinput%20type=%22checkbox%22%20onchange=%22Face.activeCheckAction(this)%22%20id=%22Face_active%22%3E%E5%BC%80%E5%90%AF%E5%AF%86%E8%AF%AD%E8%A1%A8%E6%83%85%20%3Cbutton%20onclick=%22Face.editAction()%22%3E%E7%BC%96%E8%BE%91%E8%A1%A8%E6%83%85%E5%88%97%E8%A1%A8%3C/button%3E%3Cbutton%20onclick=%22Face.saveAction()%22%3E%E4%BF%9D%E5%AD%98%3C/button%3E%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22Face_active%22,%20Face.data.active);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Face.id%20+%20%22%20start!%22);%0A%09%09if(Face.data.active)%7B%0A%09%09%09Face.initFace();%0A%09%09%7D%0A%09%7D,%0A%0A%09save%20:%20function()%7B%0A%09%09Data.save(Face);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Face);%0A%09%7D,%0A%09activeCheckAction%20:%20function()%7B%0A%09%09Face.data.active%20=%20!Face.data.active;%0A%09%09Face.setPanel();%0A%09%09Face.save();%0A%09%7D,%0A%09editAction%20:%20function()%7B%0A%09%09var%20str%20=%20%22#%E8%AF%B4%E6%98%8E%EF%BC%9A%E4%BB%BF%E7%85%A7%E5%A6%82%E4%B8%8B%E6%A0%BC%E5%BC%8F%E6%B7%BB%E5%8A%A0%E6%88%96%E6%94%B9%E5%8F%98%E8%A1%A8%E6%83%85%E7%9A%84%E9%A1%BA%E5%BA%8F%EF%BC%8C%E4%B8%80%E7%BB%84%E8%A1%A8%E6%83%85%E4%B8%8E%E4%B8%80%E4%B8%AA%E7%99%BE%E5%BA%A6%E7%A9%BA%E9%97%B4%E7%9B%B8%E5%86%8C%E7%BB%91%E5%AE%9A%3Cbr%3E#%E6%AF%8F%E7%BB%84%E5%A4%A7%E6%8B%AC%E5%8F%B7%E4%B8%AD%EF%BC%8C%E5%89%8D%E4%B8%80%E9%A1%B9%E4%B8%BA%E2%80%9C%E7%99%BE%E5%BA%A6%E7%A9%BA%E9%97%B4%E5%90%8D%E2%80%9D%EF%BC%8C%E5%90%8E%E4%B8%80%E9%A1%B9%E4%B8%BA%E2%80%9C%E7%9B%B8%E5%86%8C%E5%90%8D%E2%80%9D%EF%BC%8C%E4%B9%8B%E9%97%B4%E7%94%A8%E8%8B%B1%E6%96%87%E9%80%97%E5%8F%B7%E9%9A%94%E5%BC%80%3Cbr%3E#%E4%BF%AE%E6%94%B9%E5%90%8E%E7%82%B9%E5%87%BB%E2%80%9C%E4%BF%9D%E5%AD%98%E2%80%9D%E9%94%AE%E4%BF%9D%E5%AD%98%3Cbr%3E%3Cbr%3E%22;%0A%09%09var%20albums%20=%20Face.data.albums;%0A%09%09for(var%20i=0;%20i%3Calbums.length;%20i++)%0A%09%09%09str%20+=%20'%7B'%20+%20albums%5Bi%5D.id%20+',%20'+albums%5Bi%5D.name%20+%20%22%7D%3Cbr%3E%22;%0A%09%09TAM.setEditorText(str);%0A%09%7D,%0A%09saveAction%20:%20function()%7B%0A%09%09var%20albumStrs%20=%20TAM.getEditorText().replace(/&nbsp;/g,'%20').match(/%7B%5Ba-zA-Z0-9%25%5Cu4e00-%5Cu9fa5%5D+,%5B%20%5D*%5Ba-zA-Z0-9%25%5Cu4e00-%5Cu9fa5%5D+%7D/g);%0A%09%09if(albumStrs)%7B%0A%09%09%09var%20flag%20=%20confirm(%22%E5%85%B1%20%22+albumStrs.length+%22%20%E7%BB%84%E8%A1%A8%E6%83%85%EF%BC%8C%E7%A1%AE%E5%AE%9A%E4%BF%9D%E5%AD%98%E4%B9%88%EF%BC%9F%22);%0A%09%09%09if(flag)%7B%0A%09%09%09%09Face.data.albums%20=%20%5B%5D;%0A%09%09%09%09for(var%20i=0;%20i%3CalbumStrs.length;%20i++)%7B%0A%09%09%09%09%09var%20str%20=%20albumStrs%5Bi%5D;%0A%09%09%09%09%09var%20a%20=%20str.indexOf('%7B');%0A%09%09%09%09%09var%20b%20=%20str.indexOf(',');%0A%09%09%09%09%09var%20c%20=%20str.indexOf('%7D');%0A%09%09%09%09%09var%20id%20=%20str.substring(a+1,%20b).trim();%0A%09%09%09%09%09var%20name%20=%20str.substring(b+1,%20c).trim();%0A%09%09%09%09%09Face.data.albums.push(%7B%0A%09%09%09%09%09%09id%20:%20id,%0A%09%09%09%09%09%09name%20:%20name%0A%09%09%09%09%09%7D);%0A%09%09%09%09%09Face.save();%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D,%0A%09%0A%09FACE_INIT%20:%205,%0A%09initFace%20:%20function()%7B%0A%09%09var%20faceButton%20=%20$id('bdeSmileyTool');%0A%09%09faceButton.onclick%20=%20function()%7B%0A%09%09%09BdeText.doSmiley(faceButton);%0A%09%09%09var%20ifr=Face.getFaceIfr();%0A%09%09%09if(UA.chrome)%0A%09%09%09%09ifr.contentWindow.addEventListener(%22DOMContentLoaded%22,%20Face.addAlbums);%0A%09%09%09else%0A%09%09%09%09ifr.onload%20=%20Face.addAlbums;%0A%09%09%09return%20false;%0A%09%09%7D;%0A%09%7D,%0A%09getFaceIfr%20:%20function()%7B%0A%09%09var%20div%20=%20$id('editor_overlay');%0A%09%09return%20$tag('iframe',div)%5B0%5D;%0A%09%7D,%0A%09getFaceWindow%20:%20function()%7B%0A%09%09return%20Face.getFaceIfr().contentWindow;%0A%09%7D,%0A%09getFaceDoc%20:%20function()%7B%0A%09%09return%20Face.getFaceWindow().document;%0A%09%7D,%0A%09addAlbums%20:%20function()%7B%0A%09%09var%20doc%20=%20Face.getFaceDoc();%0A%09%09var%20tM%20=%20$id('tabMenu',%20doc);%0A%09%09var%20albums%20=%20Face.data.albums;%0A%09%09if(albums.length%20%3E%2010)%7B%0A%09%09%09tM.setAttribute('style','overflow:auto;height:320px;width:80px;');%0A%09%09%09tM.parentNode.setAttribute('style','width:410px;')%0A%09%09%7D%0A%09%09for(var%20i%20=%200;%20i%20%3C%20albums.length;%20i++)%7B%0A%09%09%09var%20num%20=%20i%20+%20Face.FACE_INIT;%0A%09%09%09tM.innerHTML%20=%20tM.innerHTML%20+%20'%3CDIV%20onclick=%22top.Face.addTabFace('+i+');switchTab('+num+')%22%20id=%22tab'+num+'%22%20class=%22menuDefault%22%3E%3Cu%3E'+albums%5Bi%5D.name+'%3C/u%3E%3C/DIV%3E';%0A%09%09%09var%20tC%20=%20$id('tabContent',%20doc);%0A%09%09%09tC.innerHTML%20+=%20'%3CDIV%20id=%22tab'+num+'%22%20style=%22display:%20block;%22%3E%3C/DIV%3E';%0A%09%09%7D%0A%09%7D,%0A%09addTabFace%20:%20function(num)%7B%0A%09%09var%20tabi%20=%20$id(%22tab%22+(num+5),%20Face.getFaceDoc());%0A%09%09tabi.innerHTML%20=%20'%3Ctable%20width=%22100%25%22%20height=%22100%25%22%20cellspacing=%221%22%20cellpadding=%221%22%20bordercolor=%22#b8b3ff%22%20border=%221%22%20align=%22center%22%20style=%22border-collapse:%20collapse;%22%3E%3Ctr%3E%3C/tr%3E%3C/table%3E'%0A%09%09var%20album%20=%20Face.data.albums%5Bnum%5D;%0A%09%09var%20albumUrl%20=%20'http://hi.baidu.com/'%20+%20encodeURI(album.id)%20+%20'/album/'%20+%20encodeURI(album.name)%20+%20'/page/0';%0A%09%09MeM.xmlhttpRequest(%7B%0A%09%09%09method%20:%20'GET',%0A%09%09%09url%20:%20albumUrl,%0A%09%09%09onload:%20function(response)%20%7B%0A%09%09%09%09var%20r%20=%20response.responseText;%0A%09%09%09%09var%20t%20=%20r.match(/albPicAllNum:%5Cd+,/g)+%22%22;%0A%09%09%09%09var%20allNum%20=%20parseInt(t.substring('albPicAllNum:'.length));%0A%09%09%09%09var%20pids%20=%20Face.getPids(r);%0A%09%09%09%09var%20num%20=%20pids.length;%0A%09%09%09%09var%20table%20=%20$tag('table',tabi)%5B0%5D;%0A%09%09%09%09Face.loopAddPics(table,%20allNum,%20num,%20pids,%200,%20album.id,%20album.name)%0A%09%09%09%7D,%0A%09%09%09cache%20:%20true%0A%09%09%7D);%0A%09%7D,%0A%09%0A%09loopAddPics%20:%20function(table,%20allNum,%20num,%20pids,%20pageNum,%20id,%20name)%7B%0A%09%09for(var%20i=0;%20i%3Cpids.length;%20i++)%7B%0A%09%09%09Face.addTablePic(table,%20pids%5Bi%5D,%20id)%0A%09%09%7D%0A%09%09if(num%20%3C%20allNum)%7B%0A%09%09%09++pageNum;%0A%09%09%09var%20nextUrl%20=%20'http://hi.baidu.com/'%20+%20encodeURI(id)%20+%20'/album/'%20+%20encodeURI(name)%20+%20'/page/'%20+%20pageNum;%0A%09%09%09MeM.xmlhttpRequest(%7B%0A%09%09%09%09method%20:%20'GET',%0A%09%09%09%09url%20:%20nextUrl,%0A%09%09%09%09onload:%20function(response)%20%7B%0A%09%09%09%09%09var%20r%20=%20response.responseText;%0A%09%09%09%09%09var%20pids%20=%20Face.getPids(r);%0A%09%09%09%09%09num%20+=%20pids.length;%0A%09%09%09%09%09Face.loopAddPics(table,%20allNum,%20num,%20pids,%20pageNum,%20id,%20name)%0A%09%09%09%09%7D,%0A%09%09%09%09cache%20:%20true%0A%09%09%09%7D);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09addTablePic%20:%20function(table,%20pid,%20id)%7B%0A%09%09var%20trs%20=%20$tag('tr',%20table);%0A%09%09var%20tr%20=%20trs%5Btrs.length-1%5D;%0A%09%09var%20tds%20=%20$tag('td',%20tr);%0A%09%09if(tds.length%20%3E=%205)%7B%0A%09%09%09tr%20=%20$cre('tr');%0A%09%09%09table.appendChild(tr);%0A%09%09%7D%0A%09%09var%20url%20=%20'http://hiphotos.baidu.com/'+id+'/pic/item/'+pid+'.jpg';%0A%09%09var%20aburl%20=%20'http://hiphotos.baidu.com/'+id+'/abpic/item/'+pid+'.jpg';%0A%09%09tr.innerHTML%20+=%20%22%3CTD%20%20bgcolor='#ffffff'%20align='center'%20onmouseout='out(this)'%20onmouseover=%5C%22over(this,'%22+url+%22','0')%5C%22%20onclick=%5C%22top.Face.addPic('%22+url+%22')%5C%22%20%3E%3CA%20%20href='javascript:void(0)'%3E%3CIMG%20style='border:0px%20;'%20width='50'%20height='50'%20src='%22+aburl+%22'%20/%3E%3C/A%3E%3C/TD%3E%22;%0A%09%7D,%0A%09%0A%09getPids%20:%20function(str)%7B%0A%09%09var%20abpids%20=%20str.match(/pid:%22%5Ba-z0-9%5D+%22/g);%0A%09%09for(var%20i=0;i%3Cabpids.length;i++)%7B%0A%09%09%09abpids%5Bi%5D%20=%20abpids%5Bi%5D.substring('pid:%22'.length,abpids%5Bi%5D.length-1);%0A%09%09%7D%0A%09%09return%20abpids;%0A%09%7D,%09%0A%09%0A%09addPic:%20function(url)%7B%0A%09%09BdeText.closePopup();%0A%09%09$id('bdeTextArea').focus();%0A%09%09var%20str='%3Cimg%20class=%22BDE_Image%22%20changedsize=%22false%22%20src=%22'%20+%20BdeText.formatURL(url)%20+%20'%22%3E';%0A%09%09BdeText.paste(str);%0A%09%09BdeText.dispatch(%22oneditorselectionchange%22);%0A%09%7D%0A%7D%0AMyApps.add(Face);%0A%0A%EF%BB%BFvar%20Sign%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_LIST,%0A%09%09PT.CLUB_LIST,%0A%09%09PT.CLUB_TIEZI%0A%09%5D,%0A%09id%20:%20'Sign',%0A%09name%20:%20'%E5%AF%86%E8%AF%AD%E7%AD%BE%E5%90%8D',%0A%09%0A%09RANDOM%20:%20%22random%22,%0A%09SPECIAL%20:%20%22special%22,%0A%09splitHTML%20:%20'%3Cbr%3E%3Cimg%20width=%22320%22%20height=%2231%22%20src=%22http://hiphotos.baidu.com/matrox/pic/item/3bb2a319d6633f0c42a9adbc.jpg%22%20changedsize=%22false%22%20class=%22BDE_Image%22%3E',%0A%09splitShowHtml%20:%20'%3Cbr%3E%3Cimg%20src=%22http://hiphotos.baidu.com/matrox/pic/item/3bb2a319d6633f0c42a9adbc.jpg%22%20changedsize=%22false%22%20class=%22BDE_Image%22%20height=%2231%22%20width=%22320%22%3E',%0A%09%0A%09%0A%09data%20:%20%7B%0A%09%09active%20:%20false,%0A%09%09way%20:%20%22special%22,%0A%09%09spNum%20:%20-1,%0A%09%09signs%20:%20%5B%5D,%0A%09%09split%20:%20false%0A%09%7D,%0A%09num%20:%20-1,%0A%09signed%20:%20false,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cform%3E%20%3Ctable%3E%20%3Ctr%3E%3Ctd%3E%20%3Cinput%20type=%22checkbox%22%20id=%22Sign_active%22%20onchange=%22Sign.activeCheckAction();%22%3E%E5%BC%80%E5%90%AF%E5%AF%86%E8%AF%AD%E7%AD%BE%E5%90%8D&nbsp;%3C/td%3E%3Ctd%3E%3Cinput%20type=%22radio%22%20id=%22Sign_spway%22%20onclick=%22Sign.setSpWayAction();%22%3E%E6%8C%87%E5%AE%9A%E7%AD%BE%E5%90%8D&nbsp;&nbsp;&nbsp;%3Cselect%20id=%22Sign_splist%22%20onchange=%22Sign.setSpNumAction(this);%22%3E%3C/select%3E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%E8%AF%BB%E5%8F%96%E7%AD%BE%E5%90%8D&nbsp;%3Cselect%20id=%22Sign_loadlist%22%20onchange=%22Sign.loadNumAction(this);%22%3E%3C/select%3E%3C/td%3E%3C/tr%3E%20%3Ctr%3E%3Ctd%3E%3Cinput%20type=%22checkbox%22%20id=%22Sign_split%22%20onchange=%22Sign.splitCheckAction();%22%3E%E4%BD%BF%E7%94%A8%E5%88%86%E5%89%B2%E7%BA%BF%3C/td%3E%3Ctd%3E%3Cinput%20type=%22radio%22%20id=%22Sign_ranway%22%20onclick=%22Sign.setRanWayAction();%22%3E%E9%9A%8F%E6%9C%BA%E7%AD%BE%E5%90%8D&nbsp;&nbsp;&nbsp;%3Cinput%20type=%22button%22%20onclick=%22Sign.newSignAction();%22%20value=%22%E6%96%B0%E5%BB%BA%22%3E&nbsp;%3Cinput%20type=%22button%22%20onclick=%22Sign.saveSignAction();%22%20value=%22%E4%BF%9D%E5%AD%98%22%3E&nbsp;%3Cinput%20type=%22button%22%20onclick=%22Sign.delSignAction();%22%20value=%22%E5%88%A0%E9%99%A4%22%3E%20%3C/td%3E%3C/tr%3E%20%3C/table%3E%3C/form%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22Sign_active%22,%20Sign.data.active);%0A%09%09$p.setBoxChecked(%22Sign_split%22,%20Sign.data.split);%0A%09%09Sign.setWayRatio();%0A%09%09Sign.setSpSelect();%0A%09%09Sign.setloadSelect();%0A%09%7D,%0A%09setFloorHTMLFilter%20:%20function()%7B%0A%09%09FLM.addFloorHTMLFilter(Sign.delSign);%0A%09%7D,%0A%09delSign%20:%20function(html)%7B%0A%09%09var%20i%20=%20html.indexOf(Sign.splitShowHtml);%0A%09%09if(i%20!=%20-1)%0A%09%09%09html%20=%20html.substring(0,%20i);%0A%09%09return%20html;%0A%09%7D,%0A%09setWayRatio%20:%20function()%7B%0A%09%09var%20w%20=%20Sign.data.way;%0A%09%09if(!w)%0A%09%09%09;%0A%09%09else%20if(w%20==%20Sign.RANDOM)%7B%0A%09%09%09$id(%22Sign_ranway%22).setAttribute(%22checked%22,%22checked%22);%0A%09%09%09$id(%22Sign_spway%22).removeAttribute(%22checked%22);%0A%09%09%7Delse%20if(w%20==%20Sign.SPECIAL)%7B%0A%09%09%09$id(%22Sign_spway%22).setAttribute(%22checked%22,%22checked%22);%0A%09%09%09$id(%22Sign_ranway%22).removeAttribute(%22checked%22);%0A%09%09%7Delse%0A%09%09%09;%0A%09%7D,%0A%09%0A%09setSpSelect%20:%20function()%7B%0A%09%09var%20select%20=%20$id(%22Sign_splist%22);%0A%09%09Sign.loadSelect(select);%0A%09%09var%20i%20=%20Sign.data.spNum;%0A%09%09if(i%20%3E=%200%20&&%20i%20%3C%20Sign.data.signs.length)%7B%0A%09%09%09select.options%5Bi+1%5D.selected%20=%20true;%0A%09%09%7D%0A%09%7D,%0A%09setloadSelect%20:%20function()%7B%0A%09%09Sign.loadSelect($id(%22Sign_loadlist%22));%0A%09%09if(typeof(Sign.data.split)%20==%20%22undefined%22)%7B%0A%09%09%09Sign.data.split%20=%20true;%0A%09%09%09Sign.save();%0A%09%09%7D%0A%09%7D,%0A%09%0A%09loadSelect%20:%20function(node)%7B%0A%09%09node.innerHTML%20=%20'%3Coption%20value=%220%22%20%3E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp%3C/option%3E';%0A%09%09for(var%20i=0;%20i%20%3C%20Sign.data.signs.length;%20i++)%7B%0A%09%09%09var%20str%20=%20'%3Coption%20value=%22'%20+%20(i+1)%20+%20'%22%3E%E7%AD%BE%E5%90%8D%E6%A1%A3'%20+%20(i+1)%20+%20'%3C/option%3E';%20%0A%09%09%09node.innerHTML%20=%20node.innerHTML%20+%20str;%0A%09%09%7D%0A%09%7D,%0A%09%0A%09start%20:%20function()%7B%0A%09%09if(Sign.data.active)%0A%09%09%09Sign.setAutoSign();%0A%09%7D,%0A%09setFloorHandler%20:%20function()%7B%7D,%0A%09%0A%09save%20:%20function()%7B%0A%09%09Data.save(Sign);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Sign);%0A%09%7D,%0A%09activeCheckAction%20:%20function()%7B%0A%09%09Sign.data.active%20=%20!Sign.data.active;%0A%09%09Sign.setPanel();%0A%09%09Sign.save();%0A%09%7D,%0A%09splitCheckAction%20:%20function()%7B%0A%09%09Sign.data.split%20=%20!Sign.data.split;%0A%09%09Sign.setPanel();%0A%09%09Sign.save();%0A%09%7D,%0A%09setSpWayAction%20:%20function()%7B%0A%09%09Sign.data.way%20=%20Sign.SPECIAL;%0A%09%09Sign.setPanel();%0A%09%09Sign.save();%0A%09%7D,%20%0A%09%0A%09setRanWayAction%20:%20function()%7B%0A%09%09Sign.data.way%20=%20Sign.RANDOM;%0A%09%09Sign.setPanel();%0A%09%09Sign.save();%0A%09%7D,%0A%09setSpNumAction%20:%20function(node)%7B%0A%09%09Sign.data.spNum%20=%20node.selectedIndex%20-%201;%0A%09%09Sign.save();%0A%09%7D,%0A%09loadNumAction%20:%20function(node)%7B%0A%09%09var%20i%20=%20node.selectedIndex%20-1;%0A%09%09Sign.num%20=%20i;%0A%09%09if(i%20%3E=%200)%0A%09%09%09TAM.setEditorText(Sign.data.signs%5Bi%5D);%0A%09%09else%0A%09%09%09TAM.setEditorText(%22%3Cbr%3E%22);%0A%09%7D,%0A%09newSignAction%20:%20function()%7B%0A%09%09Sign.num%20=%20Sign.data.signs.length;%0A%09%09TAM.setEditorText(%22%3Cbr%3E%22);%0A%09%09myAlert(%22%E6%96%B0%E7%AD%BE%E5%90%8D%EF%BC%81%E5%9C%A8%E5%8F%91%E5%B8%96%E6%A1%86%E7%BC%96%E8%BE%91%E5%90%8E%E7%82%B9%E5%87%BB%E4%BF%9D%E5%AD%98%E6%8C%89%E9%92%AE%22);%0A%09%7D,%0A%09saveSignAction%20:%20function()%7B%0A%09%09var%20signs%20=%20Sign.data.signs;%0A%09%09if(Sign.num%20%3E=%200%20&&%20Sign.num%20%3C%20signs.length)%7B%0A%09%09%09signs%5BSign.num%5D%20=%20TAM.getEditorText();%0A%09%09%7Delse%20if(Sign.num%20==%20signs.length)%7B%0A%09%09%09signs.push(TAM.getEditorText());%0A%09%09%7Delse%7B%0A%09%09%09myAlert(%22%E5%BA%8F%E5%8F%B7%E9%94%99%E8%AF%AF%EF%BC%8C%E4%BF%9D%E5%AD%98%E4%B9%8B%E5%89%8D%E5%BA%94%E7%82%B9%E5%87%BB%E2%80%9C%E6%96%B0%E5%BB%BA%E2%80%9D%E6%88%96%E8%AF%BB%E5%8F%96%E6%9F%90%E4%B8%80%E7%AD%BE%E5%90%8D%E6%A1%A3%22);%0A%09%09%09return%20;%0A%09%09%7D%0A%09%09Sign.save();%0A%09%09Sign.setPanel();%0A%09%09myAlert(%22%E7%AD%BE%E5%90%8D%E6%A1%A3%22%20+%20(Sign.num+1)%20+%20%22%E4%BF%9D%E5%AD%98%EF%BC%81%22)%0A%09%7D,%0A%09delSignAction:%20function()%7B%0A%09%09var%20signs%20=%20Sign.data.signs;%0A%09%09if(Sign.num%20%3C%200%20%7C%7C%20Sign.num%20%3E=%20signs.length)%7B%0A%09%09%09myAlert(%22%E5%BA%8F%E5%8F%B7%E9%94%99%E8%AF%AF%EF%BC%8C%E5%88%A0%E9%99%A4%E4%B9%8B%E5%89%8D%E5%BA%94%E8%AF%BB%E5%8F%96%E6%9F%90%E4%B8%80%E7%AD%BE%E5%90%8D%E6%A1%A3%22);%0A%09%09%09return;%0A%09%09%7D%0A%09%09signs.splice(Sign.num,%201);%0A%09%09Sign.save();%0A%09%09myAlert(%22%E5%88%A0%E9%99%A4%E7%AD%BE%E5%90%8D%E6%A1%A3%22%20+%20(Sign.num+1));%0A%09%09Sign.num%20=%20-1;%0A%09%09Sign.setPanel();%0A%09%7D,%0A%09setAutoSign%20:%20function()%7B%0A%09%09FOM.addActToSub(%22Sign.autoSignAction();%22);%0A%09%7D,%0A%09autoSignAction%20:%20function()%7B%0A%09%09if(!Sign.signed)%7B%0A%09%09%09var%20l%20=%20Sign.data.signs.length;%0A%09%09%09var%20i;%0A%09%09%09if(l%20==%200)%0A%09%09%09%09return;%0A%09%09%09if(Sign.data.way%20==%20Sign.RANDOM)%7B%0A%09%09%09%09i%20=%20Math.floor(Math.random()%20*%20l);%0A%09%09%09%7Delse%20if(Sign.data.way%20==%20Sign.SPECIAL)%7B%0A%09%09%09%09var%20j%20=%20Sign.data.spNum;%0A%09%09%09%09if(j%20%3E=%200%20&&%20j%20%3C%20l)%0A%09%09%09%09%09i%20=%20j;%0A%09%09%09%09else%0A%09%09%09%09%09return;%0A%09%09%09%7Delse%0A%09%09%09%09return;%0A%09%09%09if(Sign.data.split)%0A%09%09%09%09Sign.addSignSplit();%0A%09%09%09TAM.addEditorText('%3Cbr%3E'%20+%20Sign.data.signs%5Bi%5D);%0A%09%09%09if(PT.getType()==PT.TB_TIEZI%20%7C%7C%20PT.getType()==PT.TB_LIST)%0A%09%09%09%09BdeText.dispatch(%22oneditorselectionchange%22);%0A%09%09%09Sign.signed%20=%20true;%0A%09%09%7D%0A%09%7D,%0A%09addSignSplit%20:%20function()%7B%0A%09%09TAM.addEditorText(Sign.splitHTML);%0A%09%7D%0A%7D%0AMyApps.add(Sign);%0A////////////////////////////%0A%0Avar%20Hexie%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_LIST,%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC%0A%09%5D,%0A%09id%20:%20'Hexie',%0A%09name%20:%20'%E5%92%8C%E8%B0%90%E6%B5%8B%E8%AF%95',%0A%09url%20:%20%22http://204.152.214.114/~xiaohexi/ff_test.php%22,%0A%09%0A%09data%20:%20%7B%0A%09%09active%20:%20true,%0A%09%09split%20:%20%22%E5%9B%A7%22%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22Hexie.activeCheckAction(this)%22%20id=%22Hexie_active%22%3E%E5%BC%80%E5%90%AF%E5%92%8C%E8%B0%90%E6%B5%8B%E8%AF%95%20&nbsp;&nbsp;&nbsp;&nbsp;%20%E5%85%B3%E9%94%AE%E8%AF%8D%E6%9B%BF%E6%8D%A2%E6%9C%8D%E5%8A%A1%E7%94%B1%3Ca%20%20href=%22http://204.152.214.114/~xiaohexi/%22%3E%E7%99%BE%E5%BA%A6%E8%B4%B4%E5%90%A7%E5%92%8C%E8%B0%90%E6%B5%8B%E8%AF%95%E5%99%A8%3C/a%3E%E6%8F%90%E4%BE%9B%20&nbsp;%3Cbutton%20onclick=%22Hexie.setSplitAction();%22%3E%E8%AE%BE%E5%AE%9A%E5%88%86%E9%9A%94%E7%AC%A6%3C/button%3E%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22Hexie_active%22,%20Hexie.data.active);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Hexie.id%20+%20%22%20start!%22);%0A%09%09if(Hexie.data.active)%7B%0A%09%09%09Hexie.initHexie();%0A%09%09%7D%0A%09%7D,%0A%09activeCheckAction%20:%20function()%7B%0A%09%09Hexie.data.active%20=%20!Hexie.data.active;%0A%09%09Hexie.setPanel();%0A%09%09Hexie.save();%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09Data.save(Hexie);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Hexie);%0A%09%7D,%0A%09activeCheckAction%20:%20function()%7B%0A%09%09Hexie.data.active%20=%20!Hexie.data.active;%0A%09%09Hexie.setPanel();%0A%09%09Hexie.save();%0A%09%7D,%0A%09setSplitAction%20:%20function()%7B%0A%09%09var%20str%20=%20prompt('%E8%AE%BE%E5%AE%9A%E5%88%86%E9%9A%94%E7%AC%A6%EF%BC%9A',%20Hexie.data.split);%0A%09%09if(str%20&&%20str.length%20%3E%200)%7B%0A%09%09%09Hexie.data.split%20=%20str;%0A%09%09%09Hexie.save();%0A%09%09%7D%0A%09%7D,%0A%09initHexie%20:%20function()%7B%0A%09%09var%20resultParentDiv%20=%20$id(%22post%22);%0A%09%09var%20x%20=%20$cre('div');%0A%09%09x.id%20=%20%22harmonizerButtonDiv%22;%0A%09%09var%20b1%20=%20document.createElement('a');%0A%09%09var%20b1text%20=%20'%E5%92%8C%E8%B0%90%E6%B5%8B%E8%AF%95';%0A%09%09b1.appendChild(document.createTextNode(b1text));%0A%09%09b1.id%20=%20%22hexieTestLink%22;%0A%09%09b1.href%20=%20%22##%22;%0A%09%09b1.addEventListener(%22click%22,%20Hexie.hello,%20true);%0A%09%09b1.style.marginLeft%20=%20(($id(%22Submit3%22)%20%7C%7C%20$id(%22add_post_submit%22)).parentNode.parentNode.cells%5B0%5D.offsetWidth%20+%205)%20+%20%22px%22;%0A%09%09b1.style.color%20=%20%22#6CCC66%22;%0A%09%09b1.style.fontSize%20=%20%2210pt%22;%0A%09%09x.appendChild(b1);%0A%09%09resultParentDiv.insertBefore(x,%20resultParentDiv.childNodes%5B0%5D);%0A%09%7D,%0A%09%0A%09hello%20:%20function()%7B%0A%09%09var%20title%20=encodeURIComponent(Hexie.getTitle());%0A%09%09var%20content%20=%20encodeURIComponent(Hexie.getContent());%0A%09%09var%20params%20=%20'co='%20+%20title%20+%20'%7C_%7C_%7C_%7C'%20+%20content;%0A%09%09%0A%09%09$id(%22hexieTestLink%22).innerHTML%20=%20%22%E6%B5%8B%E8%AF%95%E4%B8%AD%EF%BC%8C%E8%AF%B7%E7%A8%8D%E5%80%99%E2%80%A6%E2%80%A6%22;%0A%09%09%0A%09%09MeM.xmlhttpRequest(%7B%0A%09%09%09method%20:%20'POST',%0A%09%09%09url%20:%20Hexie.url,%0A%09%09%09data%20:%20params,%0A%09%09%09headers:%20%7B%0A%09%09%09%09'Content-type':%20'application/x-www-form-urlencoded',%0A%09%09%09%09'Content-length'%20:%20params.length,%0A%09%09%09%09'Connection'%20:%20'close'%0A%09%09%09%7D,%0A%09%09%09onload:%20function(response)%20%7B%0A%09%09%09%09var%20t%20=%20response.responseText;%0A%09%09%09%09var%20ts%20=%20t.split('%7C_%7C_%7C_%7C');%0A%09%09%09%09Hexie.setTitle(ts%5B0%5D);%0A%09%09%09%09Hexie.setContent(ts%5B1%5D);%0A%09%09%09%09$id(%22hexieTestLink%22).innerHTML%20=%20%22%E5%92%8C%E8%B0%90%E6%B5%8B%E8%AF%95%22;%0A%09%09%09%7D%0A%09%09%7D);%0A%09%7D,%0A%09%0A%09getTitle%20:%20function()%7B%0A%09%09switch(PT.getType())%7B%0A%09%09%09case%20PT.TB_LIST:%0A%09%09%09%09return%20$id(%22title%22).value;%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_TIEZI:%0A%09%09%09%09return%20$tag('h1')%5B0%5D.innerHTML;%0A%09%09%09%09break;%0A%09%09%09case%20PT.TB_CLASSIC:%0A%09%09%09%09return%20$tag('h2')%5B0%5D.innerHTML;%0A%09%09%09%09break;%0A%09%09%09default:;%0A%09%09%7D%0A%09%7D,%0A%09%0A%09getContent%20:%20function()%7B%0A%09%09if(PT.getType()%20==%20PT.TB_CLASSIC)%7B%0A%09%09%09return%20$id(%22content%22).value;%0A%09%09%7D%0A%09%09else%7B%0A%09%09%09return%20TAM.getEditorText().replace(/%5Ct/g,%20'').replace(/%3Cbr%3E/g,%22%5Ct%22);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09setTitle%20:%20function(title)%7B%0A%09%09title%20=%20title.replace(/%E4%B8%84/g,%20Hexie.data.split);%0A%09%09if(PT.getType()%20==%20PT.TB_LIST)%0A%09%09%09$id(%22title%22).value%20=%20title;%0A%09%7D,%0A%09%0A%09setContent%20:%20function(content)%7B%0A%09%09content%20=%20content.replace(/%E4%B8%84/g,%20Hexie.data.split);%0A%09%09if(PT.getType()%20==%20PT.TB_CLASSIC)%0A%09%09%09$id(%22content%22).value%20=%20content;%0A%09%09else%0A%09%09%09$id(%22bdeTextArea%22).innerHTML%20=%20content.replace(/%5Ct/g,%20%22%3Cbr%3E%22);%0A%09%7D,%0A%09%0A%09loaded%20:%20function(t)%7B%0A%09%09var%20ts%20=%20t.split('%7C_%7C_%7C_%7C');%0A%09%09Hexie.setTitle(ts%5B0%5D);%0A%09%09Hexie.setContent(ts%5B1%5D);%0A%09%09$id(%22hexieTestLink%22).innerHTML%20=%20%22%E5%92%8C%E8%B0%90%E6%B5%8B%E8%AF%95%22;%0A%09%7D%0A%7D%0AMyApps.add(Hexie);%0A%0Avar%20ImgLink%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_LIST,%0A%09%09PT.TB_TIEZI,%0A%09%09PT.CLUB_TIEZI,%0A%09%09PT.CLUB_LIST,%0A%09%5D,%0A%09id%20:%20'ImgLink',%0A%09name%20:%20'%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5',%0A%09url:%20'http://miyuimg.appspot.com/',%0A%09chartpre%20:%20'http://chart.apis.google.com/chart?chst=d_text_outline&chld=000000%7C16%7Cl%7CFFFFFF%7C_%7C%25E7%2599%25BE%25E5%25BA%25A6%25E5%25AF%2586%25E8%25AF%25AD%25E2%2580%2594%25E2%2580%2594%25E5%259B%25BE%25E7%2589%2587%25E9%2593%25BE%25E6%258E%25A5%7C%25E5%258F%25B3%25E9%2594%25AE%25E5%25A4%258D%25E5%2588%25B6%25E5%259B%25BE%25E7%2589%2587%25E5%259C%25B0%25E5%259D%2580%25E5%2588%25B0%25E5%259C%25B0%25E5%259D%2580%25E6%25A0%258F%25E6%2589%2593%25E5%25BC%2580%25E5%25A6%2582%25E4%25B8%258B%25E9%2593%25BE%25E6%258E%25A5%7C',%0A%09%0A%09str%20:%20%22%22,%0A%09data%20:%20%7B%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Ctable%3E%20%3Ctr%3E%20%3Ctd%3E%3Cinput%20id=%22ImgLink_img%22%20/%3E%3C/td%3E%20%3Ctd%3E%E5%9B%BE%E7%89%87%E5%9C%B0%E5%9D%80%EF%BC%88%E5%BB%BA%E8%AE%AE%E7%95%99%E7%A9%BA%EF%BC%8C%E7%94%9F%E6%88%90%E9%BB%98%E8%AE%A4%E5%9B%BE%E7%89%87%EF%BC%89&nbsp;%3C/td%3E%20%3Ctd%3E%3Ca%20href=%22http://hi.baidu.com/matrox/blog/item/9661d917441d2d19c83d6d7e.html%22%3E&nbsp;%E4%BB%80%E4%B9%88%E6%98%AF%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%EF%BC%9F%3C/a%3E%3C/td%3E%20%3C/tr%3E%20%3Ctr%3E%20%3Ctd%3E%3Cinput%20id=%22ImgLink_link%22%20/%3E%3C/td%3E%20%3Ctd%3E%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80%EF%BC%88%E5%BF%85%E5%A1%AB%EF%BC%89%3C/td%3E%20%3Ctd%3E%3Cinput%20id=%22ImgLink_publish%22%20type=%22button%22%20value=%22%E5%8F%91%E5%B8%83%22%20onclick=%22ImgLink.publish()%22%20/%3E%3C/td%3E%20%3C/tr%3E%20%3C/table%3E';%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20ImgLink.id%20+%20%22%20start!%22);%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09//Data.save(ImgLink);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09//Data.load(ImgLink);%0A%09%7D,%0A%09publish:%20function()%7B%0A%09%09ImgLink.str%20=%20'';%0A%09%09var%20link%20=%20$id('ImgLink_link').value;%0A%09%09if(!link)%7B%0A%09%09%09myAlert('%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80%E4%B8%8D%E8%83%BD%E4%B8%BA%E7%A9%BA');%0A%09%09%09return;%0A%09%09%7D%0A%09%09%0A%09%09var%20button%20=%20$id('ImgLink_publish');%0A%09%09button.value%20=%20'%E8%AF%BB%E5%8F%96%E4%B8%AD...';%0A%09%09button.disabled%20=%20%22disabled%22;%0A%09%09%0A%09%09var%20img%20=%20$id('ImgLink_img').value;%0A%09%09if(!img)%7B%0A%09%09%09img%20=%20ImgLink.chartpre%20+%20encodeURIComponent(link);%0A%09%09%7D%0A%09%09MeM.getGoogleShortUrl(img,%20ImgLink.addImgShort);%0A%09%7D,%0A%09%0A%09addImgShort%20:%20function(r)%7B%0A%09%09ImgLink.str%20+=%20r%20+%20'_';%0A%09%09MeM.getGoogleShortUrl($id('ImgLink_link').value,%20ImgLink.addImgLinkShort);%0A%09%7D,%0A%09%0A%09addImgLinkShort%20:%20function(r)%7B%0A%09%09ImgLink.str%20+=%20r;%0A%09%09ImgLink.toImage();%0A%09%7D,%0A%09%0A%09toImage%20:%20function()%7B%0A%09%09var%20url%20=%20ImgLink.url%20+%20ImgLink.str%20+%20'.jpg';%0A%09%09var%20str%20=%20'%3Cimg%20class=%22BDE_Image%22%20changedsize=%22false%22%20src=%22'%20+%20url+%20'%22%3E';%0A%09%09TAM.addEditorText(str);%0A%09%09BdeText.dispatch(%22oneditorselectionchange%22);%0A%09%09var%20button%20=%20$id('ImgLink_publish');%0A%09%09button.value%20=%20'%E5%8F%91%E5%B8%83';%0A%09%09button.disabled%20=%20%22%22;%0A%09%7D,%0A%0A%7D%0Aif(!UA.op)%0A%09MyApps.add(ImgLink);%0A%0Avar%20Cgx%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_LIST,%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_TIEZI,%0A%09%09PT.CLUB_LIST,%0A%09%5D,%0A%09id%20:%20'Cgx',%0A%09name%20:%20'%E8%8D%89%E7%A8%BF%E7%AE%B1',%0A%09ifAddListener%20:%20false,%0A%09str%20:%20%22%22,%0A%09data%20:%20%7B%0A%09%09autoSave%20:%20false,%0A%09%09time%20:%2010,%0A%09%09str%20:%20''%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20id=%22Cgx_autoSave%22%20onchange=%22Cgx.autoSaveCheckAction()%22%3E%E8%87%AA%E5%8A%A8%E4%BF%9D%E5%AD%98%E8%8D%89%E7%A8%BF%20&nbsp;&nbsp;%3Cinput%20style=%22width:30px%22%20id=%22Cgx_time%22%20onchange=%22Cgx.timeChangeAction()%22%3E%E8%87%AA%E5%8A%A8%E4%BF%9D%E5%AD%98%E9%97%B4%E9%9A%94(%E7%A7%92)%20&nbsp;&nbsp;%3Cinput%20id=%22Cgx_handSave%22%20type=%22button%22%20value=%22%E7%AB%8B%E5%8D%B3%E4%BF%9D%E5%AD%98%22%20onclick=%22Cgx.saveTextAction(false)%22%3E&nbsp;&nbsp;%3Cinput%20id=%22Cgx_rollback%22%20type=%22button%22%20value=%22%E8%BF%98%E5%8E%9F%E8%8D%89%E7%A8%BF%22%20onclick=%22Cgx.loadTextAction()%22%3E%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22Cgx_autoSave%22,%20Cgx.data.autoSave);%0A%09%09$id(%22Cgx_time%22).setAttribute(%22value%22,%20Cgx.data.time);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Cgx.id%20+%20%22%20start!%22);%0A%09%09if(Cgx.data.autoSave)%0A%09%09%09Cgx.setAutoSave();%0A%09%7D,%0A%0A%09save%20:%20function()%7B%0A%09%09Data.save(Cgx);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Cgx);%0A%09%7D,%0A%09autoSaveCheckAction%20:%20function()%7B%0A%09%09Cgx.data.autoSave%20=%20!Cgx.data.autoSave;%0A%09%09if(Cgx.data.autoSave)%0A%09%09%09Cgx.setAutoSave();%0A%09%09Cgx.setPanel();%0A%09%09Cgx.save();%0A%09%7D,%0A%09timeChangeAction%20:%20function()%7B%0A%09%09Cgx.data.time%20=%20parseInt($id(%22Cgx_time%22).value);%0A%09%7D,%0A%09saveTextAction%20:%20function(flag)%7B%0A%09%09Cgx.data.str%20=%20TAM.getEditorText();%0A%09%09Cgx.save();%0A%09%09if(Cgx.data.autoSave%20&&%20flag)%0A%09%09%09setTimeout(function()%7B%0A%09%09%09%09Cgx.saveTextAction(flag);%0A%09%09%09%7D,%201000*Cgx.data.time)%0A%09%7D,%0A%09loadTextAction%20:%20function()%7B%0A%09%09TAM.setEditorText(Cgx.data.str);%0A%09%7D,%0A%09setAutoSave%20:%20function()%7B%0A%09%09FOM.getForm().addEventListener('click',%20Cgx.setTimeout,%20true);%0A%09%7D,%0A%09setTimeout%20:%20function()%7B%0A%09%09if(!Cgx.ifAddListener)%7B%0A%09%09%09setTimeout(function%20()%20%7B%0A%09%09%09%09Cgx.saveTextAction(true);%0A%09%09%09%7D,%201000*Cgx.data.time)%0A%09%09%09Cgx.ifAddListener%20=%20true;%0A%09%09%7D%0A%09%7D%0A%7D%0AMyApps.add(Cgx);%0A%0Avar%20Uni%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.TB_LIST,%0A%09%09PT.TB_TIEZI%0A%09%5D,%0A%09id%20:%20'Uni',%0A%09name%20:%20'Unicode',%0A%09%0A%09str%20:%20%22%22,%0A%09transed%20:%20false,%0A%09data%20:%20%7B%0A%09%09autoTrans%20:%20false,%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20id=%22Uni_autoTrans%22%20onchange=%22Uni.autoTransCheckAction()%22%3E%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2&nbsp;&nbsp;%3Cinput%20id=%22Uni_handTrans%22%20type=%22button%22%20value=%22%E8%BD%AC%E6%8D%A2%E4%B8%BAUnicode%22%20onclick=%22Uni.asciiToUnicode(false)%22%3E&nbsp;&nbsp;%3Cinput%20id=%22Uni_rollback%22%20type=%22button%22%20value=%22%E8%BF%98%E5%8E%9F%22%20onclick=%22Uni.rollback()%22%3E%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22Uni_autoTrans%22,%20Uni.data.autoTrans);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Uni.id%20+%20%22%20start!%22);%0A%09%09if(PT.getType()%20==%20PT.TB_LIST%20%7C%7C%20PT.getType()%20==%20PT.TB_TIEZI)%0A%09%09%09Uni.init();%0A%09%09if(Uni.data.autoTrans)%0A%09%09%09Uni.setAutoTrans();%0A%09%7D,%0A%0A%09save%20:%20function()%7B%0A%09%09Data.save(Uni);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Uni);%0A%09%7D,%0A%09autoTransCheckAction%20:%20function()%7B%0A%09%09Uni.data.autoTrans%20=%20!Uni.data.autoTrans;%0A%09%09Uni.setAutoTrans();%0A%09%09Uni.setPanel();%0A%09%09Uni.save();%0A%09%7D,%0A%09init%20:%20function()%7B%0A%09%09ContentInput.getHtml2%20=%20ContentInput.getHtml;%0A%09%09ContentInput.getHtml=function()%7B%0A%09%09%09var%20s%20=%20ContentInput.getHtml2();%0A%09%09%09return%20s.replace(/&amp;/g,'&');%0A%09%09%7D%0A%09%7D,%0A%09setAutoTrans%20:%20function()%7B%0A%09%09var%20actStr%20=%20%22Uni.asciiToUnicode();%22;%0A%09%09if(Uni.data.autoTrans)%7B%0A%09%09%09FOM.addActToSub(actStr);%0A%09%09%7Delse%7B%0A%09%09%09FOM.removeActInSub(actStr);%0A%09%09%7D%0A%09%7D,%0A%09asciiToUnicode%20:%20function()%7B%0A%09%09if(!Uni.transed)%7B%0A%09%09%09Uni.str%20=%20TAM.getPureEditorText();%0A%09%09%09var%20newStr%20=%20%22%22;%0A%09%09%09var%20str%20=%20Uni.str;%0A%09%09%09for%20(var%20i=0;%20i%3C%20str.length;%20i++)%7B%0A%09%09%09%09var%20s%20=%20str.charCodeAt(i);%0A%09%09%09%09if(s%20==%2010)%0A%09%09%09%09%09newStr%20+=%20'%5Cn';%0A%09%09%09%09else%0A%09%09%09%09%09newStr%20+=%20'&#'%20+%20s%20+%20';';%0A%09%09%09%7D%0A%09%09%09if(PT.getType()%20!=%20PT.TB_CLASSIC)%7B%0A%09%09%09%09newStr%20=%20newStr.replace(/%5Cn/g,%20'%3Cbr%3E');%0A%09%09%09%09newStr%20=%20newStr.replace(/&/g,%20'&amp;');%0A%09%09%09%7D%0A%09%09%09TAM.setEditorText(newStr);%0A%09%09%09Uni.transed%20=%20true;%0A%09%09%7D%0A%09%7D,%0A%09rollback%20:%20function()%7B%0A%09%09if(Uni.transed)%7B%0A%09%09%09TAM.setEditorText(Uni.str);%0A%09%09%09Uni.transed%20=%20false;%0A%09%09%7D%0A%09%7D%0A%7D%0AMyApps.add(Uni);%0A%0Avar%20Llink%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_LIST%0A%09%5D,%0A%09id%20:%20'Llink',%0A%09name%20:%20'%E5%B0%BE%E9%A1%B5%E9%93%BE%E6%8E%A5',%0A%09%0A%09data%20:%20%7B%0A%09%09active%20:%20true,%0A%09%09barText%20:%20%22%5B%3E%3E%5D%22,%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22Llink.activeCheckAction(this)%22%20id=%22Llink_active%22%3E%E5%BC%80%E5%90%AF%E5%B0%BE%E9%A1%B5%E9%93%BE%E6%8E%A5&nbsp;&nbsp;&nbsp;%3Cinput%20type=%22button%22%20onclick=%22Llink.setBarTextAction()%22%20value=%22%E8%AE%BE%E7%BD%AE%E6%8C%89%E9%94%AE%22%3E%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22Llink_active%22,%20Llink.data.active);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20Llink.id%20+%20%22%20start!%22);%0A%09%09if(Llink.data.active)%7B%0A%09%09%09Llink.setList();%0A%09%09%7D%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09Data.save(Llink);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(Llink);%0A%09%7D,%0A%09%0A%09activeCheckAction%20:%20function()%7B%0A%09%09Llink.data.active%20=%20!Llink.data.active;%0A%09%09Llink.setPanel();%0A%09%09Llink.save();%0A%09%7D,%0A%09setBarTextAction%20:%20function()%7B%0A%09%09var%20str%20=%20prompt(%22%E8%AE%BE%E7%BD%AE%E2%80%9C%E5%B0%BE%E9%A1%B5%E9%93%BE%E6%8E%A5%E2%80%9D%E6%8C%89%E9%94%AE%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%9A%22,%20Llink.data.barText);%0A%09%09if(str%20&&%20str.length%20%3E%200)%7B%0A%09%09%09Llink.data.barText%20=%20str;%0A%09%09%09Llink.save();%0A%09%09%7D%0A%09%7D,%0A%09setList%20:%20function()%7B%0A%09%09var%20tieba_name%20=%20$id(%22wd1%22).getAttribute(%22value%22);%0A%09%09var%20thread_table%20=%20$id(%22thread_list_table%22);%0A%09%09var%20table_body%20=%20$tag(%22tbody%22,%20thread_table)%5B0%5D;%0A%09%0A%09%09var%20rows%20=%20$tag(%22tr%22,table_body);%20%0A%09%09%0A%09%09for(var%20i%20=%200;%20i%20%3C%20rows.length;%20i++)%20%7B%0A%09%09%09var%20reply_num%20=%20$tag('td',%20rows%5Bi%5D)%5B1%5D.firstChild.nodeValue;%0A%09%09%09reply_num%20=%20reply_num%20-%20(reply_num%20%25%2030);%0A%09%09%09var%20td_wrap_a%20=%20$tag(%22td%22,%20rows%5Bi%5D)%5B2%5D;%0A%09%09%09var%20the_a%20=%20$tag(%22a%22,%20td_wrap_a)%5B0%5D;%0A%09%09%09var%20thread_href%20=%20the_a.getAttribute(%22href%22);%0A%09%0A%09%09%09var%20reg_href_martcher%20=%20/(.f%5C?)(k)(z=%5Cd%7B1,11%7D)/;%0A%09%09%09thread_href%20=%20thread_href.replace(reg_href_martcher,%22$1$3&ct=335544320&lm=0&sc=0&rn=30&tn=baiduPostBrowser&word=%22);%0A%09%09%09thread_href%20+=%20tieba_name%20+%20%22&pn=%22%20+%20reply_num;%0A%0A%09%09%09if%20(reply_num%20%3E%2029)%20%7B%0A%09%09%09%09var%20url_text%20=%20$tag(%22a%22,%20td_wrap_a)%5B0%5D.firstChild.nodeValue;%0A%09%09%09%09var%20last_page_a%20=%20document.createElement(%22a%22);%0A%09%09%09%09var%20new_url_text%20=%20document.createTextNode(%22%20%22+Llink.data.barText);%0A%09%09%09%09last_page_a.setAttribute(%22style%22,%20'TEXT-DECORATION:none');%0A%09%09%09%09last_page_a.setAttribute(%22href%22,thread_href);%0A%09%09%09%09last_page_a.setAttribute(%22target%22,%22_blank%22);%0A%09%09%09%09last_page_a.setAttribute(%22id%22,%22last_page_a%22);%0A%09%09%09%09last_page_a.appendChild(new_url_text);%0A%09%09%09%09if%20(the_a)%20%7B%0A%09%09%09%09%09the_a.parentNode.insertBefore(last_page_a,the_a.nextSibling);%0A%09%09%09%09%7D%20%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%0A%7D%0AMyApps.add(Llink);%0A%0Avar%20VoiceText%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_LIST,%0A%09%09PT.TB_TIEZI%0A%09%5D,%0A%09id%20:%20'VoiceText',%0A%09name%20:%20'%E8%AF%AD%E9%9F%B3%E6%96%87%E6%9C%AC',%0A%09loop%20:%20false,%0A%09%0A%09data%20:%20%7B%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20id=%22VoiceText_loop%22%20type=%22checkbox%22%20onchange=%22VoiceText.loopCheckAction()%22%20/%3E%E5%BE%AA%E7%8E%AF%E6%92%AD%E6%94%BE%20&nbsp;&nbsp;&nbsp;%3Cinput%20id=%22VoiceText_publish%22%20type=%22button%22%20value=%22%E8%BD%AC%E6%8D%A2%E4%B8%BA%E8%AF%AD%E9%9F%B3%E6%96%87%E6%9C%AC%22%20onclick=%22VoiceText.publish()%22/%3E%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22VoiceText_loop%22,%20VoiceText.loop);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20VoiceText.id%20+%20%22%20start!%22);%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09//Data.save(VoiceText);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09//Data.load(VoiceText);%0A%09%7D,%0A%09loopCheckAction%20:%20function()%7B%0A%09%09%20VoiceText.loop%20=%20!VoiceText.loop;%0A%09%09%20VoiceText.setPanel();%0A%09%7D,%0A%09publish:%20function()%7B%0A%09%09var%20button%20=%20$id('VoiceText_publish');%0A%09%09button.value%20=%20'%E8%AF%BB%E5%8F%96%E4%B8%AD...';%0A%09%09button.disabled%20=%20%22disabled%22;%0A%09%09%0A%09%09var%20str%20=%20TAM.getPureEditorText();%0A%09%09if(str.length%20%3E%20100)%7B%0A%09%09%09myAlert(%22%E8%AF%AD%E9%9F%B3%E6%96%87%E6%9C%AC%E7%9A%84%E9%95%BF%E5%BA%A6%E4%B8%8D%E8%83%BD%E8%B6%85%E8%BF%87100%E4%B8%AA%E5%AD%97%E7%AC%A6%5Cn%5Cn%E5%BD%93%E5%89%8D%E9%95%BF%E5%BA%A6:%22+str.length);%0A%09%09%09VoiceText.renewButton();%0A%09%09%09return;%0A%09%09%7D%0A%09%09%0A%09%09var%20url%20=%20VoiceText.generateUrl(str);%0A%09%09MeM.getGoogleShortUrl(url,%20VoiceText.toImage);%0A%09%7D,%0A%09%0A%09renewButton%20:%20function()%7B%0A%09%09var%20button%20=%20$id('VoiceText_publish');%0A%09%09button.value%20=%20'%E8%BD%AC%E6%8D%A2%E4%B8%BA%E8%AF%AD%E9%9F%B3%E6%96%87%E6%9C%AC';%0A%09%09button.disabled%20=%20%22%22;%0A%09%7D,%0A%09%0A%09generateUrl%20:%20function(str)%7B%0A%09%09var%20pre%20=%20%22http://translate.google.com/translate_tts?q=%22;%0A%09%09var%20end%20=%20%22&tl=zh-CN&prev=input%20HTTP/1.1%22;%0A%09%09return%20pre%20+%20encodeURIComponent(str.trim())%20+%20end;%0A%09%7D,%0A%09%0A%09toImage%20:%20function(shortUrl)%7B%0A%09%09var%20s%20=%20encodeURIComponent(%22%E7%99%BE%E5%BA%A6%E5%AF%86%E8%AF%AD%E9%9F%B3%E6%96%87%E6%9C%AC%20for%20Firefox%22);%0A%09%09var%20str%20=%20'%3Cimg%20width=%22400%22%20height=%2295%22%20title=%22http://box.baidu.com/widget/flash/bdspacesong.swf?from=tiebasongwidget&amp;url=http%253A//miyuimg.appspot.com/'+shortUrl+'.mp3&amp;name='+s+'&amp;artist=&amp;extra=&amp;autoPlay=false&amp;loop='+VoiceText.loop+'%22%20src=%22http://static.tieba.baidu.com/tb/editor/images/blank.gif%22%20class=%22BDE_Music%22%20_moz_dirty=%22%22%20_moz_resizing=%22true%22%3E';%0A%09%09TAM.setEditorText(str);%0A%09%09BdeText.dispatch(%22oneditorselectionchange%22);%0A%09%09VoiceText.renewButton();%0A%09%7D%0A%7D%0Aif(UA.ff)%0A%20%20MyApps.add(VoiceText);%0A%0Avar%20ImgText%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_LIST,%0A%09%09PT.TB_TIEZI,%0A%09%09PT.CLUB_LIST,%0A%09%09PT.CLUB_TIEZI%0A%09%5D,%0A%09id%20:%20'ImgText',%0A%09name%20:%20'%E5%9B%BE%E7%89%87%E6%96%87%E6%9C%AC',%0A%09MAX%20:%201900,%0A%09data%20:%20%7B%0A%09%09color%20:%20'000000',%0A%09%09bold%20:%20false%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20style=%22width:50px;%22%20id=%22ImgText_color%22%20onchange=%22ImgText.colorChangeAction();%22%3E&nbsp;%E9%A2%9C%E8%89%B2&nbsp;(%3Ca%20target=%22_black%22%20href=%22http://book.wyfwgw.com/color.htm%22%3E%E9%A2%9C%E8%89%B2%E4%BB%A3%E7%A0%81%E8%A1%A8%3C/a%3E)&nbsp;&nbsp;&nbsp;%3Cinput%20id=%22ImgText_bold%22%20type=%22checkbox%22%20onchange=%22ImgText.boldCheckAction()%22%20/%3E%E5%8A%A0%E7%B2%97%20&nbsp;&nbsp;&nbsp;%3Cinput%20id=%22ImgText_publish%22%20type=%22button%22%20value=%22%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%9B%BE%E7%89%87%E6%96%87%E6%9C%AC%22%20onclick=%22ImgText.publish()%22/%3E%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22ImgText_bold%22,%20ImgText.data.bold);%0A%09%09$id('ImgText_color').value%20=%20ImgText.data.color;%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20ImgText.id%20+%20%22%20start!%22);%0A%09%7D,%0A%0A%09save%20:%20function()%7B%0A%09%09Data.save(ImgText);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(ImgText);%0A%09%7D,%0A%09boldCheckAction%20:%20function()%7B%0A%09%09%20ImgText.data.bold%20=%20!ImgText.data.bold;%0A%09%09%20ImgText.setPanel();%0A%09%09%20ImgText.save();%0A%09%7D,%0A%09colorChangeAction%20:%20function()%7B%0A%09%09var%20str%20=%20$id('ImgText_color').value;%0A%09%09if(str.indexOf('#')%20==%200)%0A%09%09%09str%20=%20str.substring(1);%0A%09%09ImgText.data.color%20=%20str;%0A%09%09$id('ImgText_color').value%20=%20str;%0A%09%09ImgText.save();%0A%09%7D,%0A%09%0A%09renewButton%20:%20function()%7B%0A%09%09var%20button%20=%20$id('ImgText_publish');%0A%09%09button.value%20=%20'%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%9B%BE%E7%89%87%E6%96%87%E6%9C%AC';%0A%09%09button.disabled%20=%20%22%22;%0A%09%7D,%0A%09publish:%20function()%7B%0A%09%09var%20button%20=%20$id('ImgText_publish');%0A%09%09button.value%20=%20'%E8%AF%BB%E5%8F%96%E4%B8%AD...';%0A%09%09button.disabled%20=%20%22disabled%22;%0A%09%09%0A%09%09var%20suf%20=%20ImgText.getUrlSuffix();%0A%09%09var%20l%20=%20encodeURIComponent(suf).length;%0A%09%09if(l%20%3E%20ImgText.MAX)%7B%0A%09%09%09var%20flag%20=%20confirm(%22%E8%BD%AC%E6%8D%A2%E6%96%87%E6%9C%AC%E5%A4%AA%E9%95%BF%EF%BC%8C%E8%B6%85%E8%BF%87%22%20+%20ImgText.MAX%20+%22%E4%B8%AA%E5%AD%97%E7%AC%A6%5Cn%5Cn%E5%BD%93%E5%89%8D%E9%95%BF%E5%BA%A6%EF%BC%9A%22%20+%20l%20+%20%22%5Cn%5Cn%E6%98%AF%E5%90%A6%E5%88%86%E5%89%B2%E4%B8%BA%E5%A4%9A%E4%B8%AA%E5%9B%BE%E7%89%87%EF%BC%9F%22);%0A%09%09%09if(flag)%7B%0A%09%09%09%09ImgText.splitNum%20=%200;%20%0A%09%09%09%09ImgText.splitPublish(suf);%0A%09%09%09%7D%0A%09%09%09else%7B%0A%09%09%09%09ImgText.renewButton();%0A%09%09%09%09return%20;%0A%09%09%09%7D%0A%09%09%7Delse%7B%0A%09%09%09var%20pre%20=%20ImgText.getUrlPrefix();%0A%09%09%09MeM.getGoogleShortUrl((pre%20+%20suf).replace(/%25/g,%20'%2525'),%20function(shortUrl)%7B%0A%09%09%09%09TAM.setEditorText(%22%22);%0A%09%09%09%09ImgText.addImage(shortUrl);%0A%09%09%09%09ImgText.renewButton();%0A%09%09%09%7D);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09splitPublish%20:%20function(suf)%7B%0A%09%09if(ImgText.splitNum%20==%200)%0A%09%09%09TAM.setEditorText(%22%22);%0A%09%09//else%0A%09%09//%09TAM.addEditorText('%3Cbr%3E');%0A%09%09++ImgText.splitNum;%0A%09%09var%20pre%20=%20ImgText.getUrlPrefix();%0A%09%09var%20l%20=%20encodeURIComponent(suf).length;%0A%09%09console.log(l)%0A%09%09if(l%20%3C=%20ImgText.MAX)%7B%0A%09%09%09MeM.getGoogleShortUrl((pre%20+%20suf).replace(/%25/g,%20'%2525'),%20function(shortUrl)%7B%0A%09%09%09%09ImgText.addImage(shortUrl);%0A%09%09%09%09ImgText.renewButton();%0A%09%09%09%09myAlert(%22%E8%BD%AC%E6%8D%A2%E5%AE%8C%E6%88%90%EF%BC%81%E5%88%86%E5%89%B2%E4%B8%BA%22+ImgText.splitNum+%22%E5%BC%A0%E5%9B%BE%E7%89%87%22);%0A%09%09%09%7D);%0A%09%09%7Delse%7B%0A%09%09%09var%20i%20=%20ImgText.getMaxProperIndex(suf);%0A%09%09%09var%20str%20=%20suf.substring(0,%20i);%0A%09%09%09console.log(i)%0A%09%09%09suf%20=%20suf.substring(i);%0A%09%09%09MeM.getGoogleShortUrl((pre%20+%20str).replace(/%25/g,%20'%2525'),%20function(shortUrl)%7B%0A%09%09%09%09ImgText.addImage(shortUrl);%0A%09%09%09%09ImgText.splitPublish(suf);%0A%09%09%09%7D);%0A%09%09%7D%0A%09%7D,%0A%09getMaxProperIndex%20:%20function(str)%7B%0A%09%09var%20i%20=%200;%0A%09%09var%20index;%0A%09%09do%7B%0A%09%09%09index%20=%20i;%0A%09%09%09i++;%0A%09%09%09var%20flag%20=%20false;%0A%09%09%09while(1)%7B%0A%09%09%09%09if(str.charAt(i)%20==%20'%7C')%7B%0A%09%09%09%09%09if(str.charAt(i+1)%20==%20'%7C'%20%7C%7C%20flag)%0A%09%09%09%09%09%09flag%20=%20true;%0A%09%09%09%09%09else%0A%09%09%09%09%09%09break;%0A%09%09%09%09%7Delse%0A%09%09%09%09%09flag%20=%20false;%0A%09%09%09%09i++;%0A%09%09%09%7D%0A%09%09%7Dwhile(encodeURIComponent(str.substring(0,i)).length%20%3C%20ImgText.MAX)%0A%09%09return%20index;%0A%09%7D,%0A%09%0A%09getUrlPrefix%20:%20function()%7B%0A%09%09var%20str%20=%20%22http://chart.apis.google.com/chart?chst=d_text_outline&chld=%22%0A%09%09str%20+=%20ImgText.data.color;%0A%09%09str%20+=%20%22%7C15%7Cl%22;%0A%09%09str%20+=%20%22%7C%22%20+%20%22ffffff%22;%0A%09%09str%20+=%20%22%7C%22%20+%20%20(ImgText.data.bold?%22b%22:%22_%22)%20+%20%22%7C%22;%0A%09%09return%20str;%0A%09%7D,%0A%09%0A%09getUrlSuffix%20:%20function(txt)%7B%0A%09%09var%20txt%20=%20TAM.getPureEditorText().trim();%0A%09%09var%20count%20=%200;%0A%09%09var%20str%20=%20%22%22;%0A%09%09for(var%20i=0;%20i%3Ctxt.length;%20i++)%7B%0A%09%09%09var%20p%20=%20txt.charCodeAt(i);%0A%09%09%09if(p%20==%2010)%7B%0A%09%09%09%09str%20+=%20'%7C';%0A%09%09%09%09count%20=%200;%0A%09%09%09%09continue;%0A%09%09%09%7Delse%20if(p%20%3C%20128)%7B%0A%09%09%09%09count%20+=%208;%0A%09%09%09%7Delse%7B%0A%09%09%09%09count%20+=%2016;%0A%09%09%09%7D%0A%09%09%09str%20+=%20txt.charAt(i);%0A%09%09%09if(count%20%3E%20560)%7B%0A%09%09%09%09str%20+=%20%22%7C%22;%0A%09%09%09%09count%20=0;%0A%09%09%09%7D%0A%09%09%7D%0A%09%09return%20str;%0A%09%7D,%0A%09%0A%09addImage%20:%20function(shortUrl)%7B%0A%09%09var%20url%20=%20%22http://miyuimg.appspot.com/%22%20+%20shortUrl%20+%20'_'+%20shortUrl%20+%20'.jpg';%0A%09%09TAM.addImage(url);%0A%09%7D%0A%7D%0AMyApps.add(ImgText);%0A%0Avar%20PageGo%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_TIEZI%0A%09%5D,%0A%09id%20:%20'PageGo',%0A%09name%20:%20'%E9%A1%B5%E7%A0%81%E8%B7%B3%E8%BD%AC',%0A%09%0A%09data%20:%20%7B%0A%09%09active%20:%20true,%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22PageGo.activeCheckAction(this)%22%20id=%22PageGo_active%22%3E%E5%BC%80%E5%90%AF%E9%A1%B5%E7%A0%81%E8%B7%B3%E8%BD%AC%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22PageGo_active%22,%20PageGo.data.active);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20PageGo.id%20+%20%22%20start!%22);%0A%09%09if(PageGo.data.active)%7B%0A%09%09%09PageGo.init();%0A%09%09%7D%0A%09%7D,%0A%09save%20:%20function()%7B%0A%09%09Data.save(PageGo);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(PageGo);%0A%09%7D,%0A%09%0A%09activeCheckAction%20:%20function()%7B%0A%09%09PageGo.data.active%20=%20!PageGo.data.active;%0A%09%09PageGo.setPanel();%0A%09%09PageGo.save();%0A%09%7D,%0A%0A%09init%20:%20function()%7B%0A%09%09var%20max%20=%20$p.getMaxFloorNum();%0A%09%09if(max%20%3C%2031)%0A%09%09%09return%20;%0A%09%09var%20span%20=%20$cre('span');%0A%09%09span.innerHTML%20=%20'&nbsp;&nbsp;%3Cinput%20onkeydown=%22return%20PageGo.checkKey(event);%22%20class=%22PageGo_input%22%20style=%22width:35px;text-align:center;%22%3E%3Ca%20onclick=%22PageGo.linkJumpAction(this);%22%20href=%22##%22%3EGo!%3C/a%3E';%0A%09%09var%20nodes;%0A%09%09if(PT.getType()%20==%20PT.CLUB_TIEZI)%0A%09%09%09nodes%20=%20$cls('pagination','div');%0A%09%09else%20if(PT.getType()%20==%20PT.TB_CLASSIC)%0A%09%09%09nodes%20=%20$cls('c_pagination','li');%0A%09%09else%0A%09%09%09nodes%20=%20$cls('pagination','li');%0A%09%09for(var%20i=0;%20i%3Cnodes.length;%20i++)%0A%09%09%09nodes%5Bi%5D.appendChild(span.cloneNode(true));%0A%09%7D,%0A%09%0A%09linkJumpAction%20:%20function(link)%7B%0A%09%09var%20input%20=%20$tag('input',%20link.parentNode)%5B0%5D;%0A%09%09PageGo.jump(input)%0A%09%7D,%0A%09%0A%09checkKey%20:%20function(e)%7B%0A%09%09if(!e.ctrlKey%20&&%20e.keyCode%20==%2013)%0A%09%09%09PageGo.jump(e.target)%0A%09%7D,%0A%09jump%20:%20function(input)%7B%0A%09%09var%20num%20=%20parseInt(input.value);%0A%09%09var%20maxPage%20=%20$p.getMaxPageNum();%0A%09%09if(!isNaN(num)%20&&%20num%3E0%20&&%20num%3C=maxPage)%7B%0A%09%09%09var%20url%20=%20URLM.getGoUrlByPageNum(num);%0A%09%09%09console.log(url)%0A%09%09%09if(location.href%20!=%20url%20&&%20location.href%20!=%20url+%22##%22)%0A%09%09%09%09location.href%20=%20url;%0A%09%09%7D%0A%09%7D%0A%7D%0AMyApps.add(PageGo);%0A%0Avar%20BookMarker%20%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_TIEZI%0A%09%5D,%0A%09id%20:%20'BookMarker',%0A%09name%20:%20'%E6%A5%BC%E5%B1%82%E4%B9%A6%E7%AD%BE',%0A%09%0A%09data%20:%20%7B%0A%09%09active%20:%20true,%0A%09%09barText%20:%20%22%E4%B9%A6%E7%AD%BE%22,%0A%09%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22checkbox%22%20onchange=%22BookMarker.activeCheckAction(this)%22%20id=%22BookMarker_active%22%3E%E5%BC%80%E5%90%AF%E4%B9%A6%E7%AD%BE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;%3Cinput%20type=%22button%22%20onclick=%22BookMarker.setBarTextAction()%22%20value=%22%E8%AE%BE%E7%BD%AE%E6%8C%89%E9%94%AE%22%3E%3C/div%3E';%0A%09%7D,%0A%09setPanel%20:%20function()%7B%0A%09%09$p.setBoxChecked(%22BookMarker_active%22,%20BookMarker.data.active);%0A%09%7D,%0A%09start%20:%20function()%7B%0A%09%09console.log(%22App%20%22%20+%20BookMarker.id%20+%20%22%20start!%22);%0A%09%09if(BookMarker.data.active)%7B%0A%09%09%09BookMarker.init();%0A%09%09%7D%0A%09%7D,%0A%09setFloorHandler%20:%20function()%7B%0A%09%09if(BookMarker.data.active)%7B%0A%09%09%09FHM.addFloorHandler(BookMarker.setLink);%0A%09%09%7D%0A%09%7D,%0A%09%0A%09save%20:%20function()%7B%0A%09%09Data.save(BookMarker);%0A%09%7D,%0A%09load%20:%20function()%7B%0A%09%09Data.load(BookMarker);%0A%09%7D,%0A%09activeCheckAction%20:%20function()%7B%0A%09%09BookMarker.data.yinyongActive%20=%20!BookMarker%20.data.yinyongActive;%0A%09%09BookMarker.setPanel();%0A%09%09BookMarker.save();%0A%09%7D,%0A%0A%09setBarTextAction%20:%20function()%7B%0A%09%09var%20str%20=%20prompt(%22%E8%AE%BE%E7%BD%AE%E2%80%9C%E4%B9%A6%E7%AD%BE%E2%80%9D%E6%8C%89%E9%94%AE%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%9A%22,%20BookMarker.data.barText);%0A%09%09if(str%20&&%20str.length%20%3E%200)%7B%0A%09%09%09BookMarker.data.barText%20=%20str;%0A%09%09%09BookMarker.save();%0A%09%09%7D%0A%09%7D,%0A%0A%09init%20:%20function()%7B%0A%09%09FHM.funcToFloors(BookMarker.setLink);%0A%09%7D,%0A%09%0A%09setLink%20:%20function(floor)%7B%0A%09%09var%20span%20=%20$cre('span');%0A%09%09span.innerHTML%20=%20'%3Ca%20onclick=%22BookMarker.addBMAction(this)%22%20href=%22##%22%3E'%20+%20BookMarker.data.barText%20+%20'%3C/a%3E';%0A%09%09BARM.addItemInFloor(span,%20floor);%0A%09%7D,%0A%09%0A%09addBMAction%20:%20function(node)%7B%0A%09%09var%20floor%20=%20FLM.getParentFloor(node);%0A%09%09var%20num%20=%20FLM.getFloorNumber(floor);%0A%09%09var%20title%20=%20%22%E8%B4%B4%E5%90%A7%20%22%20+%20num%20+%20%22%E6%A5%BC%20%22+%20document.title;%0A%09%09var%20str%20=%20PT.getType()%20==%20PT.CLUB_TIEZI%20?%20%22#%22:%22##%22;%0A%09%09var%20url%20=%20%22http://%22%20+%20location.host%20+%20location.pathname%20+%20location.search%20+%20str%20+%20num;%0A%09%09window.sidebar.addPanel(title,%20url%20,%22%22);%0A%09%7D%0A%7D%0Aif(UA.ff)%0A%09MyApps.add(BookMarker);%0A%0A%EF%BB%BFCfg%20=%20%7B%0A%09pageTypes:%5B%0A%09%09PT.TB_TIEZI,%0A%09%09PT.TB_LIST,%0A%09%09PT.TB_CLASSIC,%0A%09%09PT.CLUB_TIEZI,%0A%09%09PT.CLUB_LIST%0A%09%5D,%0A%09id%20:%20'Cfg',%0A%09name%20:%20'%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE',%0A%09pre%20:%20'cfg',%0A%09data%20:%20%7B%7D,%0A%0A%09setPanel%20:%20function()%7B%7D,%0A%09start%20:function()%7B%7D,%0A%09load%20:%20function()%7B%7D,%0A%09save%20:%20function()%7B%7D,%0A%09setFloorHandler%20:%20function()%7B%7D,%0A%09%0A%09getPanelHTML%20:%20function()%7B%0A%09%09return%20'%3Cdiv%3E%3Cinput%20type=%22button%22%20onclick=%22Cfg.getAction()%22%20value=%22%E5%AF%BC%E5%87%BA%E9%85%8D%E7%BD%AE%E6%96%87%E6%9C%AC%22%3E&nbsp;&nbsp%3Cinput%20type=%22button%22%20onclick=%22Cfg.setAction()%22%20value=%22%E5%AF%BC%E5%85%A5%E9%85%8D%E7%BD%AE%E6%96%87%E6%9C%AC%22%3E&nbsp;&nbsp%3Cinput%20type=%22button%22%20onclick=%22Cfg.initAction()%22%20value=%22%E5%88%9D%E5%A7%8B%E5%8C%96%22%3E&nbsp;&nbsp%3Cinput%20type=%22button%22%20onclick=%22Cfg.clearAction()%22%20value=%22%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98%22%3E%3C/div%3E';%0A%09%7D,%0A%09%0A%09%0A%09setAction%20:%20function()%7B%0A%09%09var%20enStr%20=%20TAM.getEditorText().trim();%0A%09%09if(!enStr%20%7C%7C%20enStr.length%20%3C%208)%0A%09%09%09return%20;%0A%09%09var%20l%20=%20Cfg.pre.length;%0A%09%09var%20str%20=%20Encryptor.decrypt(enStr,%20Encryptor.DEFAULT_PW);%0A%09%09if(!str%20%7C%7C%20str.substring(0,l)%20!=%20Cfg.pre)%0A%09%09%09myAlert(%22%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%8D%E5%90%88%E6%B3%95!%22);%0A%09%09else%20if(confirm(%22%E7%A1%AE%E8%AE%A4%E5%AF%BC%E5%85%A5%E9%85%8D%E7%BD%AE%EF%BC%9F%22)%20==%20true)%20%7B%0A%09%09%09Data.setCfg(str.substring(l));%0A%09%09%09location.reload();%0A%09%09%7Delse%0A%09%09%09;%0A%09%7D,%0A%09getAction%20:%20function()%7B%0A%09%09var%20str%20=%20Cfg.pre%20+%20Data.getCfg();%0A%09%09var%20enStr%20=%20Encryptor.encrypt(str,%20Encryptor.DEFAULT_PW);%0A%09%09TAM.setEditorText(enStr);%0A%09%7D,%0A%09initAction%20:%20function()%7B%0A%09%09var%20str%20=%20%22%E6%98%AF%E5%90%A6%E5%88%9D%E5%A7%8B%E5%8C%96%E6%89%80%E6%9C%89%E8%AE%BE%E7%BD%AE%EF%BC%9F%22;%0A%09%09if(confirm(str)%20==%20true)%20%7B%0A%09%09%09Data.clear();%0A%09%09%09location.reload();%0A%09%09%7D%0A%09%7D,%0A%09clearAction%20:%20function()%7B%0A%09%09var%20str%20=%20%22%E6%B8%85%E7%A9%BA%E7%BC%93%E5%AD%98%EF%BC%9F%22;%0A%09%09if(confirm(str)%20==%20true)%20%7B%0A%09%09%09MeM.clearMessage();%0A%09%09%7D%0A%09%7D%0A%7D%0AMyApps.add(Cfg);%0AMyApps.start();";
String.prototype.trim = function () {
	return this.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
} 



function runScript(){
	var l=document.createElement('script');
	l.setAttribute('id',"miyuYun");
	l.innerHTML = decodeURI(script);
	document.body.appendChild(l);
}

function send(e){
	var ms = document.getElementById('miyusender').getElementsByTagName('message');
	for(var i=0; i<ms.length; i++){
		console.log(ms[i]);
		handleMessage(decodeURI(ms[i].innerHTML));
		ms[i].parentNode.removeChild(ms[i]);
	}
}

function setPipe(){
	console.log('setPipe');
	var sender = document.createElement('div');
	sender.id = 'miyusender';
	document.body.appendChild(sender);
	
	var receiver = document.createElement('div');
	receiver.id = 'miyureceiver';
	document.body.appendChild(receiver);
	
	sender.addEventListener('send', send ,false);
}

function replyMessage(message){
	var msg = document.createElement('message');
	msg.innerHTML = encodeURI(JSON.stringify(message));
	var receiver = document.getElementById('miyureceiver');
	receiver.appendChild(msg);
	var customEvent = document.createEvent('Event');
	customEvent.initEvent('receive', true, true);
	receiver.dispatchEvent(customEvent);
}

function handleMessage(str){
	var request = JSON.parse(str);
	setTimeout(
		function(){
			if(request.command == 'xhr')
				xmlHttp(request.content, request.id, replyMessage);
			else if(request.command == 'clearXhrCache'){
				GM_deleteValue('cache');
			}
		},
	0);	
}

function xmlHttp(content, id, callback){
	var str = content.url;
	if(content.cache){
		if(!flag){
			cache = JSON.parse(GM_getValue('cache','{}'));
			flag = true;
		}
		if(cache[str]){
			callback({
				id : id,
				content : cache[str]
			});
			return ;
		}
	}
	content.onload = function(responseDetails){
		var response ={
			status : responseDetails.status,
			header : responseDetails.responseHeaders,
			responseText : responseDetails.responseText
		}
		if(content.cache){
			cache[str] = response;
			GM_setValue("cache", JSON.stringify(cache));
			flag = false;
		}
		var message = {
			id : id,
			content : response
		};
		callback(message);
	}
    GM_xmlhttpRequest(content);
}


function runScript(){
	console.log('init: Run script!');
	var l=document.createElement('script');
	l.setAttribute('id',"miyuYun");
	l.innerHTML = decodeURI(script);
	document.body.appendChild(l);
}
function setPipe(){
	console.log('setPipe');
	var sender = document.createElement('div');
	sender.id = 'miyusender';
	sender.addEventListener('send', function() {
		var ms = sender.getElementsByTagName('message');
		for(var i=0; i<ms.length; i++){
			console.log(ms[i]);
			handleMessage(decodeURI(ms[i].innerHTML));
			sender.removeChild(ms[i]);
		}
	});
	document.body.appendChild(sender);
	
	var receiver = document.createElement('div');
	receiver.id = 'miyureceiver';
	document.body.appendChild(receiver);
}

function replyMessage(message){
	var msg = document.createElement('message');
	msg.innerHTML =  encodeURI(JSON.stringify(message));
	var receiver = document.getElementById('miyureceiver');
	receiver.appendChild(msg);
	var customEvent = document.createEvent('Event');
	customEvent.initEvent('receive', true, true);
	receiver.dispatchEvent(customEvent);
}

function handleMessage(str){
	var request = JSON.parse(str);
	if(request.command == 'xhr')
		chrome.extension.sendRequest(request, replyMessage);
	else if(request.command == 'clearXhrCache')
		chrome.extension.sendRequest(request, replyMessage);
}

console.log('init: start!');

setPipe();
runScript();

